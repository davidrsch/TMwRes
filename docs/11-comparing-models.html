<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Max Kuhn, y Julia Silge">
<title>Modelado Ordenado con R - 11&nbsp; Comparing Models with Resampling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-tuning-parameters.html" rel="next">
<link href="./10-resampling.html" rel="prev">
<link href="./images/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="TMwR.css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-resampling.html">TOOLS FOR CREATING EFFECTIVE MODELS</a></li><li class="breadcrumb-item"><a href="./11-comparing-models.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelado Ordenado con R</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/tidymodels/TMwR">
            Original
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/davidrsch/TMwRes">
            Traducción
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo lector">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hola Mundo</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">INTRODUCCIÓN</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-software-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Software para modelar</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Tidyverse Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-base-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">MODELING BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ames Housing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-spending.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spending our Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-fitting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fitting Models with parsnip</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-the-model-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">A Model Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Feature Engineering with recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-judging-model-effectiveness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Judging Model Effectiveness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">TOOLS FOR CREATING EFFECTIVE MODELS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Resampling for Evaluating Performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-comparing-models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tuning-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Tuning and the Dangers of Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-grid-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-iterative-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-workflow-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">BEYOND THE BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-dimensionality-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-encoding-categorical-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Encoding Categorical Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-explaining-models-and-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Explaining Models and Predictions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-when-should-you-trust-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">When Should You Trust Your Predictions?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-ensemble-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembles of Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-inferential-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Inferential Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pre-proc-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Recommended Preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
<li><a href="#sec-workflow-set" id="toc-sec-workflow-set" class="nav-link active" data-scroll-target="#sec-workflow-set"><span class="header-section-number">11.1</span> Creating Multiple Models with Workflow Sets</a></li>
  <li><a href="#sec-resampled-stats" id="toc-sec-resampled-stats" class="nav-link" data-scroll-target="#sec-resampled-stats"><span class="header-section-number">11.2</span> Comparing Resampled Performance Statistics</a></li>
  <li><a href="#simple-hypothesis-testing-methods" id="toc-simple-hypothesis-testing-methods" class="nav-link" data-scroll-target="#simple-hypothesis-testing-methods"><span class="header-section-number">11.3</span> Simple Hypothesis Testing Methods</a></li>
  <li>
<a href="#sec-tidyposterior" id="toc-sec-tidyposterior" class="nav-link" data-scroll-target="#sec-tidyposterior"><span class="header-section-number">11.4</span> Bayesian Methods</a>
  <ul class="collapse">
<li><a href="#a-random-intercept-model" id="toc-a-random-intercept-model" class="nav-link" data-scroll-target="#a-random-intercept-model">A random intercept model</a></li>
  <li><a href="#the-effect-of-the-amount-of-resampling" id="toc-the-effect-of-the-amount-of-resampling" class="nav-link" data-scroll-target="#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
  </ul>
</li>
  <li><a href="#sec-compare-summary" id="toc-sec-compare-summary" class="nav-link" data-scroll-target="#sec-compare-summary"><span class="header-section-number">11.5</span> Chapter Summary</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-compare" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Once we create two or more models, the next step is to compare them to understand which one is best. In some cases, comparisons might be <em>within-model</em>, where the same model might be evaluated with different features or preprocessing methods. Alternatively, <em>between-model</em> comparisons, such as when we compared linear regression and random forest models in <a href="10-resampling.html">Chapter&nbsp;<span>10</span></a>, are the more common scenario.</p>
<p>In either case, the result is a collection of resampled summary statistics (e.g., RMSE, accuracy, etc.) for each model. In this chapter, we’ll first demonstrate how workflow sets can be used to fit multiple models. Then, we’ll discuss important aspects of resampling statistics. Finally, we’ll look at how to formally compare models (using either hypothesis testing or a Bayesian approach).</p>
<section id="sec-workflow-set" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="sec-workflow-set">
<span class="header-section-number">11.1</span> Creating Multiple Models with Workflow Sets</h2>
<p>In <a href="07-the-model-workflow.html#sec-workflow-sets-intro"><span>Sección&nbsp;7.5</span></a> we described the idea of a workflow set where different preprocessors and/or models can be combinatorially generated. In <a href="10-resampling.html">Chapter&nbsp;<span>10</span></a>, we used a recipe for the Ames data that included an interaction term as well as spline functions for longitude and latitude. To demonstrate more with workflow sets, let’s create three different linear models that add these preprocessing steps incrementally; we can test whether these additional terms improve the model results. We’ll create three recipes then combine them into a workflow set:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-workflow-set_50030cef128071c5ea2f6ef793e99f93">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span> </span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_log</span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interaction_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">basic_rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_interact</span><span class="op">(</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span> <span class="op">)</span> </span>
<span></span>
<span><span class="va">spline_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">interaction_rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_ns</span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preproc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>basic <span class="op">=</span> <span class="va">basic_rec</span>, </span>
<span>       interact <span class="op">=</span> <span class="va">interaction_rec</span>, </span>
<span>       splines <span class="op">=</span> <span class="va">spline_rec</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lm_models</span> <span class="op">&lt;-</span> <span class="fu">workflow_set</span><span class="op">(</span><span class="va">preproc</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, cross <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lm_models</span></span>
<span><span class="co">## # A workflow set/tibble: 3 × 4</span></span>
<span><span class="co">##   wflow_id    info             option    result    </span></span>
<span><span class="co">##   &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    </span></span>
<span><span class="co">## 1 basic_lm    &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span><span class="co">## 2 interact_lm &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span><span class="co">## 3 splines_lm  &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’d like to resample each of these models in turn. To do so, we will use a <span class="pkg">purrr</span>-like function called <code>workflow_map()</code>. This function takes an initial argument of the function to apply to the workflows, followed by options to that function. We also set a <code>verbose</code> argument that will print the progress as well as a <code>seed</code> argument that makes sure that each model uses the same random number stream as the others.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-workflow-set-resample_875473351b94b8c83605e91077c50c4b">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_models</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">lm_models</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">workflow_map</span><span class="op">(</span><span class="st">"fit_resamples"</span>, </span>
<span>               <span class="co"># Options to `workflow_map()`: </span></span>
<span>               seed <span class="op">=</span> <span class="fl">1101</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               <span class="co"># Options to `fit_resamples()`: </span></span>
<span>               resamples <span class="op">=</span> <span class="va">ames_folds</span>, control <span class="op">=</span> <span class="va">keep_pred</span><span class="op">)</span></span>
<span><span class="co">## i 1 of 3 resampling: basic_lm</span></span>
<span><span class="co">## ✔ 1 of 3 resampling: basic_lm (3s)</span></span>
<span><span class="co">## i 2 of 3 resampling: interact_lm</span></span>
<span><span class="co">## ✔ 2 of 3 resampling: interact_lm (3.6s)</span></span>
<span><span class="co">## i 3 of 3 resampling: splines_lm</span></span>
<span><span class="co">## ✔ 3 of 3 resampling: splines_lm (5.1s)</span></span>
<span><span class="va">lm_models</span></span>
<span><span class="co">## # A workflow set/tibble: 3 × 4</span></span>
<span><span class="co">##   wflow_id    info             option    result   </span></span>
<span><span class="co">##   &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   </span></span>
<span><span class="co">## 1 basic_lm    &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">## 2 interact_lm &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">## 3 splines_lm  &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the <code>option</code> and <code>result</code> columns are now populated. The former includes the options to <code>fit_resamples()</code> that were given (for reproducibility), and the latter column contains the results produced by <code>fit_resamples()</code>.</p>
<p>There are a few convenience functions for workflow sets, including <code>collect_metrics()</code> to collate the performance statistics. We can <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to any specific metric we are interested in:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-workflow-set-collect_9003b9655e85fb479b6e4d53502139f2">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">lm_models</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 3 × 9</span></span>
<span><span class="co">##   wflow_id    .config          preproc model .metric .estimator   mean     n std_err</span></span>
<span><span class="co">##   &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">## 1 basic_lm    Preprocessor1_M… recipe  line… rmse    standard   0.0803    10 0.00264</span></span>
<span><span class="co">## 2 interact_lm Preprocessor1_M… recipe  line… rmse    standard   0.0799    10 0.00272</span></span>
<span><span class="co">## 3 splines_lm  Preprocessor1_M… recipe  line… rmse    standard   0.0785    10 0.00282</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What about the random forest model from the previous chapter? We can add it to the set by first converting it to its own workflow set then binding rows. This requires that, when the model was resampled, the <code>save_workflow = TRUE</code> option was set in the control function.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-workflow-set-four-models_a755a40e0ccc8790fb384fd6581f8592">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">four_models</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">as_workflow_set</span><span class="op">(</span>random_forest <span class="op">=</span> <span class="va">rf_res</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">lm_models</span><span class="op">)</span></span>
<span><span class="va">four_models</span></span>
<span><span class="co">## # A workflow set/tibble: 4 × 4</span></span>
<span><span class="co">##   wflow_id      info             option    result   </span></span>
<span><span class="co">##   &lt;chr&gt;         &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   </span></span>
<span><span class="co">## 1 random_forest &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">## 2 basic_lm      &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">## 3 interact_lm   &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">## 4 splines_lm    &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method, with output in <a href="#fig-workflow-set-r-squared">Figura&nbsp;<span>11.1</span></a>, shows confidence intervals for each model in order of best to worst. In this chapter, we’ll focus on the coefficient of determination (a.k.a. <span class="math inline">\(R^2\)</span>) and use <code>metric = "rsq"</code> in the call to set up our plot:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-workflow-set-rsq_c42e9efddd35402690cb5e7edaab6ebc">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">four_models</span>, metric <span class="op">=</span> <span class="st">"rsq"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">wflow_id</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, nudge_y <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-workflow-set-r-squared_cfe2278ed75ae779e1d91a4af2b35425">
<div class="cell-output-display">
<div id="fig-workflow-set-r-squared" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-workflow-set-r-squared-1.png" class="img-fluid figure-img" alt="Confidence intervals for the coefficient of determination using four different models. The random forest model has the best results and its intervals do not overlap with the intervals of the other models. " width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.1: Confidence intervals for the coefficient of determination using four different models</figcaption></figure>
</div>
</div>
</div>
<p>From this plot of <span class="math inline">\(R^2\)</span> confidence intervals, we can see that the random forest method is doing the best job and there are minor improvements in the linear models as we add more recipe steps.</p>
<p>Now that we have 10 resampled performance estimates for each of the four models, these summary statistics can be used to make between-model comparisons.</p>
</section><section id="sec-resampled-stats" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="sec-resampled-stats">
<span class="header-section-number">11.2</span> Comparing Resampled Performance Statistics</h2>
<p>Considering the preceding results for the three linear models, it appears that the additional terms do not profoundly improve the mean RMSE or <span class="math inline">\(R^2\)</span> statistics for the linear models. The difference is small, but it might be larger than the experimental noise in the system, i.e., considered statistically significant. We can formally test the hypothesis that the additional terms increase <span class="math inline">\(R^2\)</span>.</p>
<div class="rmdnote">
<p>Before making between-model comparisons, it is important for us to discuss the within-resample correlation for resampling statistics. Each model was measured with the same cross-validation folds, and results for the same resample tend to be similar.</p>
</div>
<p>In other words, there are some resamples where performance across models tends to be low and others where it tends to be high. In statistics, this is called a <em>resample-to-resample</em> component of variation.</p>
<p>To illustrate, let’s gather the individual resampling statistics for the linear models and the random forest. We will focus on the <span class="math inline">\(R^2\)</span> statistic for each model, which measures correlation between the observed and predicted sale prices for each house. Let’s <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to keep only the <span class="math inline">\(R^2\)</span> metrics, reshape the results, and compute how the metrics are correlated with each other.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-collect_32c8549fa9e728ee1f4a5e94fba09394">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_indiv_estimates</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">four_models</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rsq"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">rsq_wider</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rsq_indiv_estimates</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">wflow_id</span>, <span class="va">.estimate</span>, <span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="st">"id"</span>, names_from <span class="op">=</span> <span class="st">"wflow_id"</span>, values_from <span class="op">=</span> <span class="st">".estimate"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">corrr</span><span class="fu">::</span><span class="fu"><a href="https://corrr.tidymodels.org/reference/correlate.html">correlate</a></span><span class="op">(</span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 5</span></span>
<span><span class="co">##   term          random_forest basic_lm interact_lm splines_lm</span></span>
<span><span class="co">##   &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">## 1 random_forest        NA        0.887       0.888      0.889</span></span>
<span><span class="co">## 2 basic_lm              0.887   NA           0.993      0.997</span></span>
<span><span class="co">## 3 interact_lm           0.888    0.993      NA          0.987</span></span>
<span><span class="co">## 4 splines_lm            0.889    0.997       0.987     NA</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These correlations are high, and indicate that, across models, there are large within-resample correlations. To see this visually in <a href="#fig-rsquared-resamples">Figura&nbsp;<span>11.2</span></a>, the <span class="math inline">\(R^2\)</span> statistics are shown for each model with lines connecting the resamples:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-rsq-plot_d19e796d6b85eb0c1d1fd8b299d4d3ee">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_indiv_estimates</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>wflow_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">wflow_id</span>, <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wflow_id</span>, y <span class="op">=</span> <span class="va">.estimate</span>, group <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, linewidth <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-rsquared-resamples_861606c3a0d4d89659c4a1ccc9c89d28">
<div class="cell-output-display">
<div id="fig-rsquared-resamples" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-rsquared-resamples-1.png" class="img-fluid figure-img" alt="A plot connecting the resample statistics across models. The plot connects the results for each model with the same line. The performance metrics tend to be relatively similar across all model results. " width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.2: Resample statistics across models</figcaption></figure>
</div>
</div>
</div>
<p>If the resample-to-resample effect was not real, there would not be any parallel lines. A statistical test for the correlations evaluates whether the magnitudes of these correlations are not simply noise. For the linear models:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-resample-cor_a065aedfe3741c789e490fdb01beb9ef">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">basic_lm</span>, <span class="va">splines_lm</span><span class="op">)</span> <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 3</span></span>
<span><span class="co">##   estimate conf.low conf.high</span></span>
<span><span class="co">##      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1    0.997    0.987     0.999</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of the correlation test (the <code>estimate</code> of the correlation and the confidence intervals) show us that the within-resample correlation appears to be real.</p>
<p>What effect does the extra correlation have on our analysis? Consider the variance of a difference of two variables:</p>
<p><span class="math display">\[\operatorname{Var}[X - Y] = \operatorname{Var}[X] + \operatorname{Var}[Y]  - 2 \operatorname{Cov}[X, Y]\]</span></p>
<p>The last term is the covariance between two items. If there is a significant positive covariance, then any statistical test of this difference would be critically under-powered comparing the difference in two models. In other words, ignoring the resample-to-resample effect would bias our model comparisons towards finding no differences between models.</p>
<div class="rmdwarning">
<p>This characteristic of resampling statistics will come into play in the next two sections.</p>
</div>
<p>Before making model comparisons or looking at the resampling results, it can be helpful to define a relevant <em>practical effect size</em>. Since these analyses focus on the <span class="math inline">\(R^2\)</span> statistics, the practical effect size is the change in <span class="math inline">\(R^2\)</span> that we would consider to be a realistic difference that matters. For example, we might think that two models are not practically different if their <span class="math inline">\(R^2\)</span> values are within <span class="math inline">\(\pm 2\)</span>%. If this were the case, differences smaller than 2% are not deemed important even if they are statistically significant.</p>
<p>Practical significance is subjective; two people can have very different ideas on the threshold for importance. However, we’ll show later that this consideration can be very helpful when deciding between models.</p>
</section><section id="simple-hypothesis-testing-methods" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="simple-hypothesis-testing-methods">
<span class="header-section-number">11.3</span> Simple Hypothesis Testing Methods</h2>
<p>We can use simple hypothesis testing to make formal comparisons between models. Consider the familiar linear statistical model:</p>
<p><span class="math display">\[y_{ij} = \beta_0 + \beta_1x_{i1} + \ldots + \beta_px_{ip} + \epsilon_{ij}\]</span></p>
<p>This versatile model is used to create regression models as well as being the basis for the popular analysis of variance (ANOVA) technique for comparing groups. With the ANOVA model, the predictors (<span class="math inline">\(x_{ij}\)</span>) are binary dummy variables for different groups. From this, the <span class="math inline">\(\beta\)</span> parameters estimate whether two or more groups are different from one another using hypothesis testing techniques.</p>
<p>In our specific situation, the ANOVA can also make model comparisons. Suppose the individual resampled <span class="math inline">\(R^2\)</span> statistics serve as the <em>outcome data</em> (i.e., the <span class="math inline">\(y_{ij}\)</span>) and the models as the <em>predictors</em> in the ANOVA model. A sampling of this data structure is shown in <a href="#tbl-model-anova-data">Tabla&nbsp;<span>11.1</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/tbl-model-anova-data_ea00c8831bcff62fe57c1ee9ea1346dc">
<div class="cell-output-display">
<div id="tbl-model-anova-data" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Tabla&nbsp;11.1: Model performance statistics as a data set for analysis.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Y = rsq</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X3</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.8108</td>
<td style="text-align: left;">basic_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8134</td>
<td style="text-align: left;">interact_lm</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.8615</td>
<td style="text-align: left;">random_forest</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8217</td>
<td style="text-align: left;">splines_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.8045</td>
<td style="text-align: left;">basic_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold02</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8103</td>
<td style="text-align: left;">interact_lm</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold02</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The <code>X1</code>, <code>X2</code>, and <code>X3</code> columns in the table are indicators for the values in the <code>model</code> column. Their order was defined in the same way that R would define them, alphabetically ordered by <code>model</code>.</p>
<p>For our model comparison, the specific ANOVA model is:</p>
<p><span class="math display">\[y_{ij} = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\beta_0\)</span> is the estimate of the mean <span class="math inline">\(R^2\)</span> statistic for the basic linear models (i.e., without splines or interactions),</p></li>
<li><p><span class="math inline">\(\beta_1\)</span> is the change in mean <span class="math inline">\(R^2\)</span> when interactions are added to the basic linear model,</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> is the change in mean <span class="math inline">\(R^2\)</span> between the basic linear model and the random forest model, and</p></li>
<li><p><span class="math inline">\(\beta_3\)</span> is the change in mean <span class="math inline">\(R^2\)</span> between the basic linear model and one with interactions and splines.</p></li>
</ul>
<p>From these model parameters, hypothesis tests and p-values are generated to statistically compare models, but we must contend with how to handle the resample-to-resample effect. Historically, the resample groups would be considered a <em>block effect</em> and an appropriate term was added to the model. Alternatively, the resample effect could be considered a <em>random effect</em> where these particular resamples were drawn at random from a larger population of possible resamples. However, we aren’t really interested in these effects; we only want to adjust for them in the model so that the variances of the interesting differences are properly estimated.</p>
<p>Treating the resamples as random effects is theoretically appealing. Methods for fitting an ANOVA model with this type of random effect could include the linear mixed model <span class="citation" data-cites="faraway2016extending">(<a href="references.html#ref-faraway2016extending" role="doc-biblioref">Faraway 2016</a>)</span> or a Bayesian hierarchical model (shown in the next section).</p>
<p>A simple and fast method for comparing two models at a time is to use the differences in <span class="math inline">\(R^2\)</span> values as the outcome data in the ANOVA model. Since the outcomes are matched by resample, the differences do not contain the resample-to-resample effect and, for this reason, the standard ANOVA model is appropriate. To illustrate, this call to <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> tests the difference between two of the linear regression models:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-t-test_ae6c28bfab286895b925f8594b3427d3">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">compare_lm</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rsq_wider</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>difference <span class="op">=</span> <span class="va">splines_lm</span> <span class="op">-</span> <span class="va">basic_lm</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">difference</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">compare_lm</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">p.value</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 4</span></span>
<span><span class="co">##   estimate   p.value conf.low conf.high</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1  0.00913 0.0000256  0.00650    0.0118</span></span>
<span></span>
<span><span class="co"># Alternatively, a paired t-test could also be used: </span></span>
<span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">splines_lm</span>, <span class="va">basic_lm</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">p.value</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 4</span></span>
<span><span class="co">##   estimate   p.value conf.low conf.high</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1  0.00913 0.0000256  0.00650    0.0118</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could evaluate each pair-wise difference in this way. Note that the p-value indicates a <em>statistically significant</em> signal; the collection of spline terms for longitude and latitude do appear to have an effect. However, the difference in <span class="math inline">\(R^2\)</span> is estimated at 0.91%. If our practical effect size were 2%, we might not consider these terms worth including in the model.</p>
<div class="rmdnote">
<p>We’ve briefly mentioned p-values already, but what actually are they? From <span class="citation" data-cites="pvalue">Wasserstein y Lazar (<a href="references.html#ref-pvalue" role="doc-biblioref">2016</a>)</span>: “Informally, a p-value is the probability under a specified statistical model that a statistical summary of the data (e.g., the sample mean difference between two compared groups) would be equal to or more extreme than its observed value.”</p>
<p>In other words, if this analysis were repeated a large number of times under the null hypothesis of no differences, the p-value reflects how extreme our observed results would be in comparison.</p>
</div>
</section><section id="sec-tidyposterior" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="sec-tidyposterior">
<span class="header-section-number">11.4</span> Bayesian Methods</h2>
<p>We just used hypothesis testing to formally compare models, but we can also take a more general approach to making these formal comparisons using random effects and Bayesian statistics <span class="citation" data-cites="mcelreath2020statistical">(<a href="references.html#ref-mcelreath2020statistical" role="doc-biblioref">McElreath 2020</a>)</span>. While the model is more complex than the ANOVA method, the interpretation is more simple and straight-forward than the p-value approach. The previous ANOVA model had the form:</p>
<p><span class="math display">\[y_{ij} = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}\]</span></p>
<p>where the residuals <span class="math inline">\(\epsilon_{ij}\)</span> are assumed to be independent and follow a Gaussian distribution with zero mean and constant standard deviation of <span class="math inline">\(\sigma\)</span>. From this assumption, statistical theory shows that the estimated regression parameters follow a multivariate Gaussian distribution and, from this, p-values and confidence intervals are derived.</p>
<p>A Bayesian linear model makes additional assumptions. In addition to specifying a distribution for the residuals, we require <em>prior distribution</em> specifications for the model parameters ( <span class="math inline">\(\beta_j\)</span> and <span class="math inline">\(\sigma\)</span> ). These are distributions for the parameters that the model assumes before being exposed to the observed data. For example, a simple set of prior distributions for our model might be:</p>
<span class="math display">\[\begin{align}
\epsilon_{ij} &amp;\sim N(0, \sigma) \notag \\
\beta_j &amp;\sim N(0, 10) \notag \\
\sigma &amp;\sim \text{exponential}(1) \notag
\end{align}\]</span>
<p>These priors set the possible/probable ranges of the model parameters and have no unknown parameters. For example, the prior on <span class="math inline">\(\sigma\)</span> indicates that values must be larger than zero, are very right-skewed, and have values that are usually less than 3 or 4.</p>
<p>Note that the regression parameters have a pretty wide prior distribution, with a standard deviation of 10. In many cases, we might not have a strong opinion about the prior beyond it being symmetric and bell shaped. The large standard deviation implies a fairly uninformative prior; it is not overly restrictive in terms of the possible values that the parameters might take on. This allows the data to have more of an influence during parameter estimation.</p>
<p>Given the observed data and the prior distribution specifications, the model parameters can then be estimated. The final distributions of the model parameters are combinations of the priors and the likelihood estimates. These <em>posterior distributions</em> of the parameters are the key distributions of interest. They are a full probabilistic description of the model’s estimated parameters.</p>
<section id="a-random-intercept-model" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="a-random-intercept-model">A random intercept model</h3>
<p>To adapt our Bayesian ANOVA model so that the resamples are adequately modeled, we consider a <em>random intercept model</em>. Here, we assume that the resamples impact the model only by changing the intercept. Note that this constrains the resamples from having a differential impact on the regression parameters <span class="math inline">\(\beta_j\)</span>; these are assumed to have the same relationship across resamples. This model equation is:</p>
<p><span class="math display">\[y_{ij} = (\beta_0 + b_{i}) + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}\]</span></p>
<p>This is not an unreasonable model for resampled statistics which, when plotted across models as in <a href="#fig-rsquared-resamples">Figura&nbsp;<span>11.2</span></a>, tend to have fairly parallel effects across models (i.e., little cross-over of lines).</p>
<p>For this model configuration, an additional assumption is made for the prior distribution of random effects. A reasonable assumption for this distribution is another symmetric distribution, such as another bell-shaped curve. Given the effective sample size of 10 in our summary statistic data, let’s use a prior that is wider than a standard normal distribution. We’ll use a t-distribution with a single degree of freedom (i.e.&nbsp;<span class="math inline">\(b_i \sim t(1)\)</span>), which has heavier tails than an analogous Gaussian distribution.</p>
<p>The <span class="pkg">tidyposterior</span> package has functions to fit such Bayesian models for the purpose of comparing resampled models. The main function is called <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> and it is configured to “just work” for different types of objects:</p>
<ul>
<li><p>For workflow sets, it creates an ANOVA model where the groups correspond to the workflows. Our existing models did not optimize any tuning parameters (see the next three chapters). If one of the workflows in the set had data on tuning parameters, the best tuning parameters set for each workflow is used in the Bayesian analysis. In other words, despite the presence of tuning parameters, <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> focuses on making <em>between-workflow comparisons</em>.</p></li>
<li><p>For objects that contain a single model that has been tuned using resampling, <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> makes <em>within-model comparisons</em>. In this situation, the grouping variables tested in the Bayesian ANOVA model are the submodels defined by the tuning parameters.</p></li>
<li><p>The <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> function can also take a data frame produced by <span class="pkg">rsample</span> that has columns of performance metrics associated with two or more model/workflow results. These could have been generated by nonstandard means.</p></li>
</ul>
<p>From any of these types of objects, the <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> function determines an appropriate Bayesian model and fits it with the resampling statistics. For our example, it will model the four sets of <span class="math inline">\(R^2\)</span> statistics associated with the workflows.</p>
<p>The <span class="pkg">tidyposterior</span> package uses the <a href="https://mc-stan.org/">Stan software</a> for specifying and fitting the models via the <span class="pkg">rstanarm</span> package. The functions within that package have default priors (see <code><a href="https://mc-stan.org/rstanarm/reference/priors.html">?priors</a></code> for more details). The following model uses the default priors for all parameters except for the random intercepts (which follow a <em>t</em>-distribution). The estimation process uses random numbers so the seed is set within the function call. The estimation process is iterative and replicated several times in collections called <em>chains</em>. The <code>iter</code> parameter tells the function how long to run the estimation process in each chain. When several chains are used, their results are combined (assume that this is validated by diagnostic assessments).</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-fit-stan_025b74747981325b3979ec28162f29e4">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyposterior.tidymodels.org">tidyposterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The rstanarm package creates copious amounts of output; those results</span></span>
<span><span class="co"># are not shown here but are worth inspecting for potential issues. The</span></span>
<span><span class="co"># option `refresh = 0` can be used to eliminate the logging. </span></span>
<span><span class="va">rsq_anova</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod</a></span><span class="op">(</span></span>
<span>    <span class="va">four_models</span>,</span>
<span>    metric <span class="op">=</span> <span class="st">"rsq"</span>,</span>
<span>    prior_intercept <span class="op">=</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">student_t</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1102</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting object has information on the resampling process as well as the Stan object embedded within (in an element called <code>stan</code>). We are most interested in the posterior distributions of the regression parameters. The <span class="pkg">tidyposterior</span> package has a <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method that extracts these posterior distributions into a tibble:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-group-posteriors-tidy_6f20dd9bf3db66bf2d5c56c23ce75647">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_post</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rsq_anova</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Take a random sample from the posterior distribution</span></span>
<span>  <span class="co"># so set the seed again to be reproducible. </span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1103</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">model_post</span><span class="op">)</span></span>
<span><span class="co">## Rows: 40,000</span></span>
<span><span class="co">## Columns: 2</span></span>
<span><span class="co">## $ model     &lt;chr&gt; "random_forest", "basic_lm", "interact_lm", "splines_lm", "rando…</span></span>
<span><span class="co">## $ posterior &lt;dbl&gt; 0.8342, 0.7916, 0.7988, 0.8015, 0.8393, 0.7976, 0.7981, 0.8089, …</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The four posterior distributions are visualized in <a href="#fig-four-posteriors">Figura&nbsp;<span>11.3</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-group-posteriors-res_2f501e6941e35587d1e625142b6bf649">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_post</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>model <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">model</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-four-posteriors_39e6eb31aa6abfeab79a2114678308aa">
<div class="cell-output-display">
<div id="fig-four-posteriors" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-four-posteriors-1.png" class="img-fluid figure-img" alt="Posterior distributions for the coefficient of determination using four different models. The distribution corresponding to random forest is largest and has little overlap with the other model's posteriors." width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.3: Posterior distributions for the coefficient of determination using four different models</figcaption></figure>
</div>
</div>
</div>
<p>These histograms describe the estimated probability distributions of the mean <span class="math inline">\(R^2\)</span> value for each model. There is some overlap, especially for the three linear models.</p>
<p>There is also a basic <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method for the model results, shown in <a href="#fig-credible-intervals">Figura&nbsp;<span>11.4</span></a>, as well as the tidied object that shows overlaid density plots.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-autoplot-intervals_5a2ad6d2668b050fdac9141c60526ca0">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rsq_anova</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">workflow</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, nudge_y <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-credible-intervals_c59860eee95ca67902c13ab18741cff4">
<div class="cell-output-display">
<div id="fig-credible-intervals" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-credible-intervals-1.png" class="img-fluid figure-img" alt="Credible intervals derived from the model posterior distributions. Random forest shows the best results with no overlap with the other credible intervals. " width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.4: Credible intervals derived from the model posterior distributions</figcaption></figure>
</div>
</div>
</div>
<p>One wonderful aspect of using resampling with Bayesian models is that, once we have the posteriors for the parameters, it is trivial to get the posterior distributions for combinations of the parameters. For example, to compare the two linear regression models, we are interested in the difference in means. The posterior of this difference is computed by sampling from the individual posteriors and taking the differences. The <code><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models()</a></code> function can do this. To specify the comparisons to make, the <code>list_1</code> and <code>list_2</code> parameters take character vectors and compute the differences between the models in those lists (parameterized as <code>list_1 - list_2</code>).</p>
<p>We can compare two of the linear models and visualize the results in <a href="#fig-posterior-difference">Figura&nbsp;<span>11.5</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-lm-difference-posterior_11dc8a41ca136286b1f8a44d6d86b9f3">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rqs_diff</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models</a></span><span class="op">(</span><span class="va">rsq_anova</span>,</span>
<span>                  list_1 <span class="op">=</span> <span class="st">"splines_lm"</span>,</span>
<span>                  list_2 <span class="op">=</span> <span class="st">"basic_lm"</span>,</span>
<span>                  seed <span class="op">=</span> <span class="fl">1104</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rqs_diff</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">difference</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-posterior-difference_cac0c6355b4af80f6eeba9b39720f61b">
<div class="cell-output-display">
<div id="fig-posterior-difference" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-posterior-difference-1.png" class="img-fluid figure-img" alt="The posterior distribution for the difference in the coefficient of determination. The distribution has almost no overlap with zero." width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.5: Posterior distribution for the difference in the coefficient of determination</figcaption></figure>
</div>
</div>
</div>
<p>The posterior shows that the center of the distribution is greater than zero (indicating that the model with splines typically had larger values) but does overlap with zero to a degree. The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method for this object computes the mean of the distribution as well as credible intervals, the Bayesian analog to confidence intervals.</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-lm-summary_a3b44d2a61b7dde9195f7f3602fda01d">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rqs_diff</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##   contrast               probability    mean   lower  upper  size</span></span>
<span><span class="co">##   &lt;chr&gt;                        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 splines_lm vs basic_lm        1.00 0.00919 0.00510 0.0132     0</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>probability</code> column reflects the proportion of the posterior that is greater than zero. This is the probability that the positive difference is real. The value is not close to zero, providing a strong case for statistical significance, i.e., the idea that statistically the actual difference is not zero.</p>
<p>However, the estimate of the mean difference is fairly close to zero. Recall that the practical effect size we suggested previously is 2%. With a posterior distribution, we can also compute the probability of being practically significant. In Bayesian analysis, this is a <em>ROPE estimate</em> (for Region Of Practical Equivalence, <span class="citation" data-cites="kruschke2018bayesian">Kruschke y Liddell (<a href="references.html#ref-kruschke2018bayesian" role="doc-biblioref">2018</a>)</span>). To estimate this, the <code>size</code> option to the summary function is used:</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-lm-pract_4cfe3ca411c5c88a84cc95d3f1bc5ba9">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rqs_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contrast</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 4</span></span>
<span><span class="co">##   contrast               pract_neg pract_equiv pract_pos</span></span>
<span><span class="co">##   &lt;chr&gt;                      &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 splines_lm vs basic_lm         0        1.00    0.0001</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>pract_equiv</code> column is the proportion of the posterior that is within <code>[-size, size]</code> (the columns <code>pract_neg</code> and <code>pract_pos</code> are the proportions that are below and above this interval). This large value indicates that, for our effect size, there is an overwhelming probability that the two models are practically the same. Even though the previous plot showed that our difference is likely nonzero, the equivalence test suggests that it is small enough to not be practically meaningful.</p>
<p>The same process could be used to compare the random forest model to one or both of the linear regressions that were resampled. In fact, when <code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> is used with a workflow set, the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method can show the <code>pract_equiv</code> results that compare each workflow to the current best (the random forest model, in this case).</p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-rope-plot_6ce4a1928a04a0db7b548f58ac464059">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rsq_anova</span>, type <span class="op">=</span> <span class="st">"ROPE"</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">workflow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-practical-equivalence_219d6e80c82ae5e2ef12ab1ecbcbd3c8">
<div class="cell-output-display">
<div id="fig-practical-equivalence" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-practical-equivalence-1.png" class="img-fluid figure-img" alt="Probability of practical equivalence for an effect size of 2%. No other models have a nonzero change of matching the random forest results." width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.6: Probability of practical equivalence for an effect size of 2%</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-practical-equivalence">Figura&nbsp;<span>11.6</span></a> shows us that none of the linear models comes close to the random forest model when a 2% practical effect size is used.</p>
</section><section id="the-effect-of-the-amount-of-resampling" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</h3>
<p>How does the number of resamples affect these types of formal Bayesian comparisons? More resamples increases the precision of the overall resampling estimate; that precision propagates to this type of analysis. For illustration, additional resamples were added using repeated cross-validation. How did the posterior distribution change? <a href="#fig-intervals-over-replicates">Figura&nbsp;<span>11.7</span></a> shows the 90% credible intervals with up to 100 resamples (generated from 10 repeats of 10-fold cross-validation).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/compare-cred-int_f980c88c345374f2e0f1e3e76380d108">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">intervals</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resamples</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of Resamples (repeated 10-fold cross-validation)"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="11-comparing-models_cache/html/fig-intervals-over-replicates_a9ec58ac12b77e056dc0429ba5f32ddd">
<div class="cell-output-display">
<div id="fig-intervals-over-replicates" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-intervals-over-replicates-1.png" class="img-fluid figure-img" alt="The probability of practical equivalence to the random forest model." width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;11.7: Probability of practical equivalence to the random forest model</figcaption></figure>
</div>
</div>
</div>
<p>The width of the intervals decreases as more resamples are added. Clearly, going from ten resamples to thirty has a larger impact than going from eighty to 100. There are diminishing returns for using a “large” number of resamples (“large” will be different for different data sets).</p>
</section></section><section id="sec-compare-summary" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="sec-compare-summary">
<span class="header-section-number">11.5</span> Chapter Summary</h2>
<p>This chapter described formal statistical methods for testing differences in performance between models. We demonstrated the within-resample effect, where results for the same resample tend to be similar; this aspect of resampled summary statistics requires appropriate analysis in order for valid model comparisons. Further, although statistical significance and practical significance are both important concepts for model comparisons, they are different.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-faraway2016extending" class="csl-entry" role="listitem">
Faraway, J. 2016. <em>Extending the linear model with <span>R</span>: generalized linear, mixed effects and nonparametric regression models</em>. CRC press.
</div>
<div id="ref-kruschke2018bayesian" class="csl-entry" role="listitem">
Kruschke, J, y T Liddell. 2018. <span>«The <span>Bayesian</span> New Statistics: Hypothesis testing, estimation, meta-analysis, and power analysis from a <span>Bayesian</span> perspective»</span>. <em>Psychonomic Bulletin and Review</em> 25 (1): 178-206.
</div>
<div id="ref-mcelreath2020statistical" class="csl-entry" role="listitem">
McElreath, R. 2020. <em>Statistical rethinking: A <span>Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em>. CRC press.
</div>
<div id="ref-pvalue" class="csl-entry" role="listitem">
Wasserstein, R, y N Lazar. 2016. <span>«The <span>ASA</span> statement on p-values: Context, process, and purpose»</span>. <em>The American Statistician</em> 70 (2): 129-33.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>The code to generate <code>intervals</code> is available at <a href="https://github.com/tidymodels/TMwR/blob/main/extras/ames_posterior_intervals.R" class="uri">https://github.com/tidymodels/TMwR/blob/main/extras/ames_posterior_intervals.R</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script>

  // Chapter name
  const currentChapterFile = window.location.pathname.split('/').pop().replace('.html', '');

  //Deffining urls
  const originalURL = "https://github.com/tidymodels/TMwR";
  const translationURL = "https://github.com/davidrsch/TMwRes";

  //Deffining texts
  const edit_text = "Editar esta página";
  const issue_text = "Informar de un problema"

  //Deffining git_i
  const git_i = '<div><i class="bi bi-github"></i></div>';

  // Adding TOC if not exist
  const sidebarmargin = document.getElementById('quarto-margin-sidebar');
  const buscar_TOC = document.getElementById('TOC');

  if (!buscar_TOC) {
    const crear_TOC = document.createElement('nav');
    crear_TOC.id = 'TOC';
    crear_TOC.role = "doc-toc";
    crear_TOC.class = "toc-active";
    sidebarmargin.appendChild(crear_TOC);
  }


  // Adding original github actions
  const TOC = document.getElementById('TOC');
  const originalga = document.createElement('h2');
  originalga.textContent = "Original";
  const toc_act_O = document.createElement('div');
  toc_act_O.className = 'toc-actions';
  toc_act_O.id = 'toc-act-O';
  const act_link_O = document.createElement('div');
  act_link_O.className='action-links';
  act_link_O.id='act-link-O';
  const edit_issue_O ='<p><a href="'+originalURL+'/edit/main/'+currentChapterFile+'.Rmd" class="toc-action">'+edit_text+'</p><p><a href="'+originalURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(originalga);
  TOC.appendChild(toc_act_O);
  toc_act_O.innerHTML += git_i;
  toc_act_O.appendChild(act_link_O);
  act_link_O.innerHTML += edit_issue_O;

  // Adding translation github actions
  const translationga = document.createElement('h2');
  translationga.textContent = "Traducción";
  const toc_act_T = document.createElement('div');
  toc_act_T.className = 'toc-actions';
  toc_act_T.id = 'toc-act-T';
  const act_link_T = document.createElement('div');
  act_link_T.className='action-links';
  act_link_T.id='act-link-T';
  const edit_issue_T ='<p><a href="'+translationURL+'/edit/main/'+currentChapterFile+'.qmd" class="toc-action">'+edit_text+'</p><p><a href="'+translationURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(translationga);
  TOC.appendChild(toc_act_T);
  toc_act_T.innerHTML += git_i;
  toc_act_T.appendChild(act_link_T);
  act_link_T.innerHTML += edit_issue_T;


</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./10-resampling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Resampling for Evaluating Performance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-tuning-parameters.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Tuning and the Dangers of Overfitting</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Modelado Ordenado con R fue escrito por Max Kuhn, y Julia Silge.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>