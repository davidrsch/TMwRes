<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Max Kuhn, y Julia Silge">
<title>Modelado Ordenado con R - 16&nbsp; Dimensionality Reduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./17-encoding-categorical-data.html" rel="next">
<link href="./15-workflow-sets.html" rel="prev">
<link href="./images/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="TMwR.css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16-dimensionality-reduction.html">BEYOND THE BASICS</a></li><li class="breadcrumb-item"><a href="./16-dimensionality-reduction.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelado Ordenado con R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidrsch/TMwRes" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello World</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">INTRODUCTION</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-software-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Software for modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Tidyverse Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-base-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">MODELING BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ames Housing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-spending.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spending our Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-fitting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fitting Models with parsnip</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-the-model-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">A Model Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Feature Engineering with recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-judging-model-effectiveness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Judging Model Effectiveness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">TOOLS FOR CREATING EFFECTIVE MODELS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Resampling for Evaluating Performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-comparing-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tuning-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Tuning and the Dangers of Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-grid-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-iterative-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-workflow-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">BEYOND THE BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-dimensionality-reduction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-encoding-categorical-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Encoding Categorical Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-explaining-models-and-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Explaining Models and Predictions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-when-should-you-trust-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">When Should You Trust Your Predictions?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-ensemble-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembles of Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-inferential-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Inferential Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pre-proc-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Recommended Preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#what-problems-can-dimensionality-reduction-solve" id="toc-what-problems-can-dimensionality-reduction-solve" class="nav-link active" data-scroll-target="#what-problems-can-dimensionality-reduction-solve"><span class="header-section-number">16.1</span> What Problems Can Dimensionality Reduction Solve?</a></li>
  <li><a href="#sec-beans" id="toc-sec-beans" class="nav-link" data-scroll-target="#sec-beans"><span class="header-section-number">16.2</span> A Picture Is Worth a Thousand… Beans</a></li>
  <li><a href="#a-starter-recipe" id="toc-a-starter-recipe" class="nav-link" data-scroll-target="#a-starter-recipe"><span class="header-section-number">16.3</span> A Starter Recipe</a></li>
  <li>
<a href="#sec-recipe-functions" id="toc-sec-recipe-functions" class="nav-link" data-scroll-target="#sec-recipe-functions"><span class="header-section-number">16.4</span> Recipes in the Wild</a>
  <ul class="collapse">
<li><a href="#sec-prep" id="toc-sec-prep" class="nav-link" data-scroll-target="#sec-prep"><span class="header-section-number">16.4.1</span> Preparing a recipe</a></li>
  <li><a href="#sec-bake" id="toc-sec-bake" class="nav-link" data-scroll-target="#sec-bake"><span class="header-section-number">16.4.2</span> Baking the recipe</a></li>
  </ul>
</li>
  <li>
<a href="#feature-extraction-techniques" id="toc-feature-extraction-techniques" class="nav-link" data-scroll-target="#feature-extraction-techniques"><span class="header-section-number">16.5</span> Feature Extraction Techniques</a>
  <ul class="collapse">
<li><a href="#principal-component-analysis" id="toc-principal-component-analysis" class="nav-link" data-scroll-target="#principal-component-analysis"><span class="header-section-number">16.5.1</span> Principal component analysis</a></li>
  <li><a href="#partial-least-squares" id="toc-partial-least-squares" class="nav-link" data-scroll-target="#partial-least-squares"><span class="header-section-number">16.5.2</span> Partial least squares</a></li>
  <li><a href="#independent-component-analysis" id="toc-independent-component-analysis" class="nav-link" data-scroll-target="#independent-component-analysis"><span class="header-section-number">16.5.3</span> Independent component analysis</a></li>
  <li><a href="#uniform-manifold-approximation-and-projection" id="toc-uniform-manifold-approximation-and-projection" class="nav-link" data-scroll-target="#uniform-manifold-approximation-and-projection"><span class="header-section-number">16.5.4</span> Uniform manifold approximation and projection</a></li>
  </ul>
</li>
  <li><a href="#sec-bean-models" id="toc-sec-bean-models" class="nav-link" data-scroll-target="#sec-bean-models"><span class="header-section-number">16.6</span> Modeling</a></li>
  <li><a href="#sec-dimensionality-summary" id="toc-sec-dimensionality-summary" class="nav-link" data-scroll-target="#sec-dimensionality-summary"><span class="header-section-number">16.7</span> Chapter Summary</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/davidrsch/TMwRes/edit/main/16-dimensionality-reduction.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/davidrsch/TMwRes/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-dimensionality" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dimensionality reduction transforms a data set from a high-dimensional space into a low-dimensional space, and can be a good choice when you suspect there are “too many” variables. An excess of variables, usually predictors, can be a problem because it is difficult to understand or visualize data in higher dimensions.</p>
<section id="what-problems-can-dimensionality-reduction-solve" class="level2" data-number="16.1"><h2 data-number="16.1" class="anchored" data-anchor-id="what-problems-can-dimensionality-reduction-solve">
<span class="header-section-number">16.1</span> What Problems Can Dimensionality Reduction Solve?</h2>
<p>Dimensionality reduction can be used either in feature engineering or in exploratory data analysis. For example, in high-dimensional biology experiments, one of the first tasks, before any modeling, is to determine if there are any unwanted trends in the data (e.g., effects not related to the question of interest, such as lab-to-lab differences). Debugging the data is difficult when there are hundreds of thousands of dimensions, and dimensionality reduction can be an aid for exploratory data analysis.</p>
<p>Another potential consequence of having a multitude of predictors is possible harm to a model. The simplest example is a method like ordinary linear regression where the number of predictors should be less than the number of data points used to fit the model. Another issue is multicollinearity, where between-predictor correlations can negatively impact the mathematical operations used to estimate a model. If there are an extremely large number of predictors, it is fairly unlikely that there are an equal number of real underlying effects. Predictors may be measuring the same latent effect(s), and thus such predictors will be highly correlated. Many dimensionality reduction techniques thrive in this situation. In fact, most can be effective only when there are such relationships between predictors that can be exploited.</p>
<div class="rmdnote">
<p>When starting a new modeling project, reducing the dimensions of the data may provide some intuition about how hard the modeling problem may be.</p>
</div>
<p>Principal component analysis (PCA) is one of the most straightforward methods for reducing the number of columns in the data set because it relies on linear methods and is unsupervised (i.e., does not consider the outcome data). For a high-dimensional classification problem, an initial plot of the main PCA components might show a clear separation between the classes. If this is the case, then it is fairly safe to assume that a linear classifier might do a good job. However, the converse is not true; a lack of separation does not mean that the problem is insurmountable.</p>
<p>The dimensionality reduction methods discussed in this chapter are generally <em>not</em> feature selection methods. Methods such as PCA represent the original predictors using a smaller subset of new features. All of the original predictors are required to compute these new features. The exception to this are sparse methods that have the ability to completely remove the impact of predictors when creating the new features.</p>
<div class="rmdnote">
<p>This chapter has two goals:</p>
<ul>
<li><p>Demonstrate how to use recipes to create a small set of features that capture the main aspects of the original predictor set.</p></li>
<li><p>Describe how recipes can be used on their own (as opposed to being used in a workflow object, as in Section @ref(using-recipes)).</p></li>
</ul>
</div>
<p>The latter is helpful when testing or debugging a recipe. However, as described in Section @ref(using-recipes), the best way to use a recipe for modeling is from within a workflow object.</p>
<p>In addition to the <span class="pkg">tidymodels</span> package, this chapter uses the following packages: <span class="pkg">baguette</span>, <span class="pkg">beans</span>, <span class="pkg">bestNormalize</span>, <span class="pkg">corrplot</span>, <span class="pkg">discrim</span>, <span class="pkg">embed</span>, <span class="pkg">ggforce</span>, <span class="pkg">klaR</span>, <span class="pkg">learntidymodels</span>,<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="pkg">mixOmics</span>,<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and <span class="pkg">uwot</span>.</p>
</section><section id="sec-beans" class="level2" data-number="16.2"><h2 data-number="16.2" class="anchored" data-anchor-id="sec-beans">
<span class="header-section-number">16.2</span> A Picture Is Worth a Thousand… Beans</h2>
<p>Let’s walk through how to use dimensionality reduction with <span class="pkg">recipes</span> for an example data set. <span class="citation" data-cites="beans">Koklu and Ozkan (<a href="references.html#ref-beans" role="doc-biblioref">2020</a>)</span> published a data set of visual characteristics of dried beans and described methods for determining the varieties of dried beans in an image. While the dimensionality of these data is not very large compared to many real-world modeling problems, it does provide a nice working example to demonstrate how to reduce the number of features. From their manuscript:</p>
<blockquote class="blockquote">
<p>The primary objective of this study is to provide a method for obtaining uniform seed varieties from crop production, which is in the form of population, so the seeds are not certified as a sole variety. Thus, a computer vision system was developed to distinguish seven different registered varieties of dry beans with similar features in order to obtain uniform seed classification. For the classification model, images of 13,611 grains of 7 different registered dry beans were taken with a high-resolution camera.</p>
</blockquote>
<p>Each image contains multiple beans. The process of determining which pixels correspond to a particular bean is called <em>image segmentation</em>. These pixels can be analyzed to produce features for each bean, such as color and morphology (i.e., shape). These features are then used to model the outcome (bean variety) because different bean varieties look different. The training data come from a set of manually labeled images, and this data set is used to create a predictive model that can distinguish between seven bean varieties: Cali, Horoz, Dermason, Seker, Bombay, Barbunya, and Sira. Producing an effective model can help manufacturers quantify the homogeneity of a batch of beans.</p>
<p>There are numerous methods for quantifying shapes of objects <span class="citation" data-cites="Mingqiang08">(<a href="references.html#ref-Mingqiang08" role="doc-biblioref">Mingqiang, Kidiyo, and Joseph 2008</a>)</span>. Many are related to the boundaries or regions of the object of interest. Example of features include:</p>
<ul>
<li><p>The <em>area</em> (or size) can be estimated using the number of pixels in the object or the size of the convex hull around the object.</p></li>
<li><p>We can measure the <em>perimeter</em> using the number of pixels in the boundary as well as the area of the bounding box (the smallest rectangle enclosing an object).</p></li>
<li><p>The <em>major axis</em> quantifies the longest line connecting the most extreme parts of the object. The <em>minor axis</em> is perpendicular to the major axis.</p></li>
<li><p>We can measure the <em>compactness</em> of an object using the ratio of the object’s area to the area of a circle with the same perimeter. For example, the symbols “•” and “×” have very different compactness.</p></li>
<li><p>There are also different measures of how <em>elongated</em> or oblong an object is. For example, the <em>eccentricity</em> statistic is the ratio of the major and minor axes. There are also related estimates for roundness and convexity.</p></li>
</ul>
<p>Notice the eccentricity for the different shapes in Figure @ref(fig:eccentricity).</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/eccentricity_db852ee1fbea698dbacf52d5edb594eb">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="premade/morphology.svg" class="img-fluid figure-img" style="width:95.0%" alt="Some example shapes and their eccentricity statistics. Circles and squares have the smallest eccentricity values while X shapes and lightning bolts have the largest. Also, the eccentricity is the same when shapes are rotated."></p>
<figcaption class="figure-caption">Some example shapes and their eccentricity statistics</figcaption></figure>
</div>
</div>
</div>
<p>Shapes such as circles and squares have low eccentricity while oblong shapes have high values. Also, the metric is unaffected by the rotation of the object.</p>
<p>Many of these image features have high correlations; objects with large areas are more likely to have large perimeters. There are often multiple methods to quantify the same underlying characteristics (e.g., size).</p>
<p>In the bean data, 16 morphology features were computed: area, perimeter, major axis length, minor axis length, aspect ratio, eccentricity, convex area, equiv diameter, extent, solidity, roundness, compactness, shape factor 1, shape factor 2, shape factor 3, and shape factor 4. The latter four are described in <span class="citation" data-cites="symons1988211">Symons and Fulcher (<a href="references.html#ref-symons1988211" role="doc-biblioref">1988</a>)</span>.</p>
<p>We can begin by loading the data:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-import_683e3bfe9a7175644a9b0b944dfdf341">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">beans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdwarning">
<p>It is important to maintain good data discipline when evaluating dimensionality reduction techniques, especially if you will use them within a model.</p>
</div>
<p>For our analyses, we start by holding back a testing set with <code>initial_split()</code>. The remaining data are split into training and validation sets:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-split_955fe68ddeb4f59c9c6879058c5fc251">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1601</span><span class="op">)</span></span>
<span><span class="va">bean_split</span> <span class="op">&lt;-</span> <span class="fu">initial_validation_split</span><span class="op">(</span><span class="va">beans</span>, strata <span class="op">=</span> <span class="va">class</span>, prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.125</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Warning: Too little data to stratify.</span></span>
<span><span class="co">## • Resampling will be unstratified.</span></span>
<span><span class="va">bean_split</span></span>
<span><span class="co">## &lt;Training/Validation/Testing/Total&gt;</span></span>
<span><span class="co">## &lt;10206/1702/1703/13611&gt;</span></span>
<span></span>
<span><span class="co"># Return data frames:</span></span>
<span><span class="va">bean_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">bean_split</span><span class="op">)</span></span>
<span><span class="va">bean_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">bean_split</span><span class="op">)</span></span>
<span><span class="va">bean_validation</span> <span class="op">&lt;-</span> <span class="fu">validation</span><span class="op">(</span><span class="va">bean_split</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1602</span><span class="op">)</span></span>
<span><span class="co"># Return an 'rset' object to use with the tune functions:</span></span>
<span><span class="va">bean_val</span> <span class="op">&lt;-</span> <span class="fu">validation_set</span><span class="op">(</span><span class="va">bean_split</span><span class="op">)</span></span>
<span><span class="va">bean_val</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## &lt;Training/Validation/Total&gt;</span></span>
<span><span class="co">## &lt;10206/1702/11908&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To visually assess how well different methods perform, we can estimate the methods on the training set (n = 10,206 beans) and display the results using the validation set (n = 1,702).</p>
<p>Before beginning any dimensionality reduction, we can spend some time investigating our data. Since we know that many of these shape features are probably measuring similar concepts, let’s take a look at the correlation structure of the data in Figure @ref(fig:beans-corr-plot) using this code.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-corr-plot_03bd6f789a93b78cbbfd275c6e51c95a">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span></span>
<span><span class="va">tmwr_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#91CBD765"</span>, <span class="st">"#CA225E"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bean_train</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu">tmwr_cols</span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, tl.col <span class="op">=</span> <span class="st">"black"</span>, method <span class="op">=</span> <span class="st">"ellipse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/beans-corr-plot_b0b4f948b22754b913a3efae0e0cfa53">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/beans-corr-plot-1.png" class="img-fluid figure-img" style="width:70.0%" alt="A correlation matrix of the predictors with variables ordered via clustering. There are two to three clusters that have high within cluster correlations."></p>
<figcaption class="figure-caption">Correlation matrix of the predictors with variables ordered via clustering</figcaption></figure>
</div>
</div>
</div>
<p>Many of these predictors are highly correlated, such as area and perimeter or shape factors 2 and 3. While we don’t take the time to do it here, it is also important to see if this correlation structure significantly changes across the outcome categories. This can help create better models.</p>
</section><section id="a-starter-recipe" class="level2" data-number="16.3"><h2 data-number="16.3" class="anchored" data-anchor-id="a-starter-recipe">
<span class="header-section-number">16.3</span> A Starter Recipe</h2>
<p>It’s time to look at the beans data in a smaller space. We can start with a basic recipe to preprocess the data prior to any dimensionality reduction steps. Several predictors are ratios and so are likely to have skewed distributions. Such distributions can wreak havoc on variance calculations (such as the ones used in PCA). The <a href="https://petersonr.github.io/bestNormalize/"><span class="pkg">bestNormalize</span> package</a> has a step that can enforce a symmetric distribution for the predictors. We’ll use this to mitigate the issue of skewed distributions:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-initial-rec_db7b75ce9f0026446564136f89d2d61f">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/">bestNormalize</a></span><span class="op">)</span></span>
<span><span class="va">bean_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># Use the training data from the bean_val split object</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">bean_train</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm</a></span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdnote">
<p>Remember that when invoking the <code><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe()</a></code> function, the steps are not estimated or executed in any way.</p>
</div>
<p>This recipe will be extended with additional steps for the dimensionality reduction analyses. Before doing so, let’s go over how a recipe can be used outside of a workflow.</p>
</section><section id="sec-recipe-functions" class="level2" data-number="16.4"><h2 data-number="16.4" class="anchored" data-anchor-id="sec-recipe-functions">
<span class="header-section-number">16.4</span> Recipes in the Wild</h2>
<p>As mentioned in Section @ref(using-recipes), a workflow containing a recipe uses <code><a href="https://generics.r-lib.org/reference/fit.html">fit()</a></code> to estimate the recipe and model, then <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> to process the data and make model predictions. There are analogous functions in the <span class="pkg">recipes</span> package that can be used for the same purpose:</p>
<ul>
<li>
<code>prep(recipe, training)</code> fits the recipe to the training set.</li>
<li>
<code>bake(recipe, new_data)</code> applies the recipe operations to <code>new_data</code>.</li>
</ul>
<p>Figure @ref(fig:recipe-process) summarizes this. Let’s look at each of these functions in more detail.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/recipe-process_d81d891d67fa20bbd4ff9d8c999e1d9c">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="premade/recipes-process.svg" class="img-fluid figure-img" style="width:80.0%" alt="A summary of the recipe-related functions."></p>
<figcaption class="figure-caption">Summary of recipe-related functions</figcaption></figure>
</div>
</div>
</div>
<section id="sec-prep" class="level3" data-number="16.4.1"><h3 data-number="16.4.1" class="anchored" data-anchor-id="sec-prep">
<span class="header-section-number">16.4.1</span> Preparing a recipe</h3>
<p>Let’s estimate <code>bean_rec</code> using the training set data, with <code>prep(bean_rec)</code>:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-prep-rec_9ac89fc3a4d187eff11d20ea4e020da1">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">&lt;-</span> <span class="fu">prep</span><span class="op">(</span><span class="va">bean_rec</span><span class="op">)</span></span>
<span><span class="va">bean_rec_trained</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Recipe ───────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Inputs</span></span>
<span><span class="co">## Number of variables by role</span></span>
<span><span class="co">## outcome:    1</span></span>
<span><span class="co">## predictor: 16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Training information</span></span>
<span><span class="co">## Training data contained 10206 data points and no incomplete rows.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Operations</span></span>
<span><span class="co">## • Zero variance filter removed: &lt;none&gt; | Trained</span></span>
<span><span class="co">## • orderNorm transformation on: area, perimeter, major_axis_length, ... | Trained</span></span>
<span><span class="co">## • Centering and scaling for: area, perimeter, major_axis_length, ... | Trained</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdnote">
<p>Remember that <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> for a recipe is like <code><a href="https://generics.r-lib.org/reference/fit.html">fit()</a></code> for a model.</p>
</div>
<p>Note in the output that the steps have been trained and that the selectors are no longer general (i.e., <code><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors()</a></code>); they now show the actual columns that were selected. Also, <code>prep(bean_rec)</code> does not require the <code>training</code> argument. You can pass any data into that argument, but omitting it means that the original <code>data</code> from the call to <code><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe()</a></code> will be used. In our case, this was the training set data.</p>
<p>One important argument to <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> is <code>retain</code>. When <code>retain = TRUE</code> (the default), the estimated version of the training set is kept within the recipe. This data set has been pre-processed using all of the steps listed in the recipe. Since <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> has to execute the recipe as it proceeds, it may be advantageous to keep this version of the training set so that, if that data set is to be used later, redundant calculations can be avoided. However, if the training set is big, it may be problematic to keep such a large amount of data in memory. Use <code>retain = FALSE</code> to avoid this.</p>
<p>Once new steps are added to this estimated recipe, reapplying <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> will estimate only the untrained steps. This will come in handy when we try different feature extraction methods.</p>
<div class="rmdwarning">
<p>If you encounter errors when working with a recipe, <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> can be used with its <code>verbose</code> option to troubleshoot:</p>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-prep-fail_405610a5b4efd67568cb9f5eef0261f1">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="va">cornbread</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># &lt;- not a real predictor</span></span>
<span>  <span class="fu">prep</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## oper 1 step zv [pre-trained]</span></span>
<span><span class="co">## oper 2 step orderNorm [pre-trained]</span></span>
<span><span class="co">## oper 3 step normalize [pre-trained]</span></span>
<span><span class="co">## oper 4 step dummy [training]</span></span>
<span><span class="co">## Error in `step_dummy()`:</span></span>
<span><span class="co">## Caused by error in `prep()`:</span></span>
<span><span class="co">## ! Can't subset columns that don't exist.</span></span>
<span><span class="co">## ✖ Column `cornbread` doesn't exist.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another option that can help you understand what happens in the analysis is <code>log_changes</code>:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-prep-log_f2e2bce74f81b2dea854f9512b0db0c9">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">show_variables</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bean_rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">prep</span><span class="op">(</span>log_changes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## step_zv (zv_RLYwH): same number of columns</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## step_orderNorm (orderNorm_Jx8oD): same number of columns</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## step_normalize (normalize_GU75D): same number of columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-bake" class="level3" data-number="16.4.2"><h3 data-number="16.4.2" class="anchored" data-anchor-id="sec-bake">
<span class="header-section-number">16.4.2</span> Baking the recipe</h3>
<div class="rmdnote">
<p>Using <code><a href="https://recipes.tidymodels.org/reference/bake.html">bake()</a></code> with a recipe is much like using <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> with a model; the operations estimated from the training set are applied to any data, like testing data or new data at prediction time.</p>
</div>
<p>For example, the validation set samples can be processed:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-bake_6cfc9542c1b7ab2f231462916c505e58">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_val_processed</span> <span class="op">&lt;-</span> <span class="fu">bake</span><span class="op">(</span><span class="va">bean_rec_trained</span>, new_data <span class="op">=</span> <span class="va">bean_validation</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Figure @ref(fig:bean-area) shows histograms of the <code>area</code> predictor before and after the recipe was prepared.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-bake-off_f901789d7fab775ebc9461075c191b18">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bean_validation</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Original validation set data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bean_val_processed</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Processed validation set data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-area_2027a3c69b0ff83b0aa93b9f1d6729fc">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-area-1.png" class="img-fluid figure-img" alt="The `area` predictor before and after preprocessing. The before panel shows a right-skewed, slightly bimodal distribution. The after panel has a distribution that is fairly bell shaped." width="672"></p>
<figcaption class="figure-caption">The <code>area</code> predictor before and after preprocessing</figcaption></figure>
</div>
</div>
</div>
<p>Two important aspects of <code><a href="https://recipes.tidymodels.org/reference/bake.html">bake()</a></code> are worth noting here.</p>
<p>First, as previously mentioned, using <code>prep(recipe, retain = TRUE)</code> keeps the existing processed version of the training set in the recipe. This enables the user to use <code>bake(recipe, new_data = NULL)</code>, which returns that data set without further computations. For example:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-new-data-null_5752c6f54d3ec71782c0dba705e734b0">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">bake</span><span class="op">(</span><span class="va">bean_rec_trained</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] 10206</span></span>
<span><span class="va">bean_train</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] 10206</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the training set is not pathologically large, using this value of <code>retain</code> can save a lot of computational time.</p>
<p>Second, additional selectors can be used in the call to specify which columns to return. The default selector is <code>everything()</code>, but more specific directives can be used.</p>
<p>We will use <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code> and <code><a href="https://recipes.tidymodels.org/reference/bake.html">bake()</a></code> in the next section to illustrate some of these options.</p>
</section></section><section id="feature-extraction-techniques" class="level2" data-number="16.5"><h2 data-number="16.5" class="anchored" data-anchor-id="feature-extraction-techniques">
<span class="header-section-number">16.5</span> Feature Extraction Techniques</h2>
<p>Since recipes are the primary option in tidymodels for dimensionality reduction, let’s write a function that will estimate the transformation and plot the resulting data in a scatter plot matrix via the <span class="pkg">ggforce</span> package:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-function_2332cc34e02522e36d6785e255c87ca6">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com">ggforce</a></span><span class="op">)</span></span>
<span><span class="va">plot_validation_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">recipe</span>, <span class="va">dat</span> <span class="op">=</span> <span class="va">bean_validation</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">recipe</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># Estimate any additional steps</span></span>
<span>    <span class="fu">prep</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># Process the data (the validation set by default)</span></span>
<span>    <span class="fu">bake</span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># Create the scatterplot matrix</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.panel_x</span>, y <span class="op">=</span> <span class="va">.panel_y</span>, color <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_autohistogram.html">geom_autodensity</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_matrix.html">facet_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">class</span><span class="op">)</span>, layer.diag <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will reuse this function several times in this chapter.</p>
<p>A series of several feature extraction methodologies are explored here. An overview of most can be found in <a href="https://bookdown.org/max/FES/numeric-many-to-many.html#linear-projection-methods">Section 6.3.1</a> of <span class="citation" data-cites="fes">Kuhn and Johnson (<a href="references.html#ref-fes" role="doc-biblioref">2020</a>)</span> and the references therein. The UMAP method is described in <span class="citation" data-cites="mcinnes2020umap">McInnes, Healy, and Melville (<a href="references.html#ref-mcinnes2020umap" role="doc-biblioref">2020</a>)</span>.</p>
<section id="principal-component-analysis" class="level3" data-number="16.5.1"><h3 data-number="16.5.1" class="anchored" data-anchor-id="principal-component-analysis">
<span class="header-section-number">16.5.1</span> Principal component analysis</h3>
<p>We’ve mentioned PCA several times already in this book, and it’s time to go into more detail. PCA is an unsupervised method that uses linear combinations of the predictors to define new features. These features attempt to account for as much variation as possible in the original data. We add <code><a href="https://recipes.tidymodels.org/reference/step_pca.html">step_pca()</a></code> to the original recipe and use our function to visualize the results on the validation set in Figure @ref(fig:bean-pca) using:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-pca_cd2948e1ce9ce116f384bc071d986a64">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_pca</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">plot_validation_results</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Principal Component Analysis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-pca_3bf13fde26f841a9ac54840ef86e4095">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-pca-1.png" class="img-fluid figure-img" alt="Principal component scores for the bean validation set, colored by class. The classes separate when the first two components are plotted against one another." width="672"></p>
<figcaption class="figure-caption">Principal component scores for the bean validation set, colored by class</figcaption></figure>
</div>
</div>
</div>
<p>We see that the first two components <code>PC1</code> and <code>PC2</code>, especially when used together, do an effective job distinguishing between or separating the classes. This may lead us to expect that the overall problem of classifying these beans will not be especially difficult.</p>
<p>Recall that PCA is unsupervised. For these data, it turns out that the PCA components that explain the most variation in the predictors also happen to be predictive of the classes. What features are driving performance? The <span class="pkg">learntidymodels</span> package has functions that can help visualize the top features for each component. We’ll need the prepared recipe; the PCA step is added in the following code along with a call to <code><a href="https://recipes.tidymodels.org/reference/prep.html">prep()</a></code>:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-pca-loadings_e24824a4a25eb1c0bd7620cadc92136a">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">learntidymodels</span><span class="op">)</span></span>
<span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_pca</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/learntidymodels/man/plot_top_loadings.html">plot_top_loadings</a></span><span class="op">(</span><span class="va">component_number</span> <span class="op">&lt;=</span> <span class="fl">4</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Principal Component Analysis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This produces Figure @ref(fig:pca-loadings).</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/pca-loadings_0e593f1a8c59954ed2a6750d4f2efbc6">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/pca-loadings-1.png" class="img-fluid figure-img" alt="Predictor loadings for the PCA transformation. For the first component, the major axis length, second shape factor, convex area, and area have the largest effect. " width="672"></p>
<figcaption class="figure-caption">Predictor loadings for the PCA transformation</figcaption></figure>
</div>
</div>
</div>
<p>The top loadings are mostly related to the cluster of correlated predictors shown in the top-left portion of the previous correlation plot: perimeter, area, major axis length, and convex area. These are all related to bean size. Shape factor 2, from <span class="citation" data-cites="symons1988211">Symons and Fulcher (<a href="references.html#ref-symons1988211" role="doc-biblioref">1988</a>)</span>, is the area over the cube of the major axis length and is therefore also related to bean size. Measures of elongation appear to dominate the second PCA component.</p>
</section><section id="partial-least-squares" class="level3" data-number="16.5.2"><h3 data-number="16.5.2" class="anchored" data-anchor-id="partial-least-squares">
<span class="header-section-number">16.5.2</span> Partial least squares</h3>
<p>PLS, which we introduced in Section @ref(submodel-trick), is a supervised version of PCA. It tries to find components that simultaneously maximize the variation in the predictors while also maximizing the relationship between those components and the outcome. Figure @ref(fig:bean-pls) shows the results of this slightly modified version of the PCA code:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-pls_5c8e7ba64143853caf46124737fa81a0">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_pls</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span>, outcome <span class="op">=</span> <span class="st">"class"</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">plot_validation_results</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Partial Least Squares"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-pls_87796dbcaf1c5d4e3554e3004cf0f722">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-pls-1.png" class="img-fluid figure-img" alt="PLS component scores for the bean validation set, colored by class. The first two PLS components are nearly identical to the first two PCA components." width="672"></p>
<figcaption class="figure-caption">PLS component scores for the bean validation set, colored by class</figcaption></figure>
</div>
</div>
</div>
<p>The first two PLS components plotted in Figure @ref(fig:bean-pls) are nearly identical to the first two PCA components! We find this result because those PCA components are so effective at separating the varieties of beans. The remaining components are different. Figure @ref(fig:pls-loadings) visualizes the loadings, the top features for each component.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-pls-loadings_bc23c55db3287da6f69ae52c88849781">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_pls</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span>, outcome <span class="op">=</span> <span class="st">"class"</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/learntidymodels/man/plot_top_loadings.html">plot_top_loadings</a></span><span class="op">(</span><span class="va">component_number</span> <span class="op">&lt;=</span> <span class="fl">4</span>, n <span class="op">=</span> <span class="fl">5</span>, type <span class="op">=</span> <span class="st">"pls"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Partial Least Squares"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/pls-loadings_6bd6ac6931b543904a2f7eca350534f2">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/pls-loadings-1.png" class="img-fluid figure-img" alt="Predictor loadings for the PLS transformation. For the first component, the major axis length, second shape factor, the equivalent diameter, convex area, and area have the largest effect. " width="672"></p>
<figcaption class="figure-caption">Predictor loadings for the PLS transformation</figcaption></figure>
</div>
</div>
</div>
<p>Solidity (i.e., the density of the bean) drives the third PLS component, along with roundness. Solidity may be capturing bean features related to “bumpiness” of the bean surface since it can measure irregularity of the bean boundaries.</p>
</section><section id="independent-component-analysis" class="level3" data-number="16.5.3"><h3 data-number="16.5.3" class="anchored" data-anchor-id="independent-component-analysis">
<span class="header-section-number">16.5.3</span> Independent component analysis</h3>
<p>ICA is slightly different than PCA in that it finds components that are as statistically independent from one another as possible (as opposed to being uncorrelated). It can be thought of as maximizing the “non-Gaussianity” of the ICA components, or separating information instead of compressing information like PCA. Let’s use <code><a href="https://recipes.tidymodels.org/reference/step_ica.html">step_ica()</a></code> to produce Figure @ref(fig:bean-ica):</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-ica_ad1407ff4dd5af67bc0bb2f37d5fb582">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_ica</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">plot_validation_results</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Independent Component Analysis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-ica_d0d8d1b3cabb8a5fbb26466240dbef5c">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-ica-1.png" class="img-fluid figure-img" alt="ICA component scores for the bean validation set, colored by class. There is significant overlap in the first two ICA components." width="672"></p>
<figcaption class="figure-caption">ICA component scores for the bean validation set, colored by class</figcaption></figure>
</div>
</div>
</div>
<p>Inspecting this plot, there does not appear to be much separation between the classes in the first few components when using ICA. These independent (or as independent as possible) components do not separate the bean types.</p>
</section><section id="uniform-manifold-approximation-and-projection" class="level3" data-number="16.5.4"><h3 data-number="16.5.4" class="anchored" data-anchor-id="uniform-manifold-approximation-and-projection">
<span class="header-section-number">16.5.4</span> Uniform manifold approximation and projection</h3>
<p>UMAP is similar to the popular t-SNE method for nonlinear dimension reduction. In the original high-dimensional space, UMAP uses a distance-based nearest neighbor method to find local areas of the data where the data points are more likely to be related. The relationship between data points is saved as a directed graph model where most points are not connected.</p>
<p>From there, UMAP translates points in the graph to the reduced dimensional space. To do this, the algorithm has an optimization process that uses cross-entropy to map data points to the smaller set of features so that the graph is well approximated.</p>
<p>To create the mapping, the <span class="pkg">embed</span> package contains a step function for this method, visualized in Figure @ref(fig:bean-umap).</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-umap_d053e7636586c7fa6361dfd59acd87e7">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://embed.tidymodels.org">embed</a></span><span class="op">)</span></span>
<span><span class="va">bean_rec_trained</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://embed.tidymodels.org/reference/step_umap.html">step_umap</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">plot_validation_results</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"UMAP"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-umap_8be83b1ce9d98eef229d9dadb03a0ced">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-umap-1.png" class="img-fluid figure-img" alt="UMAP component scores for the bean validation set, colored by class. There is a very high degree of separation between clusters, but several of the clusters contain more than one class." width="672"></p>
<figcaption class="figure-caption">UMAP component scores for the bean validation set, colored by class</figcaption></figure>
</div>
</div>
</div>
<p>While the between-cluster space is pronounced, the clusters can contain a heterogeneous mixture of classes.</p>
<p>There is also a supervised version of UMAP:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-umap-supervised_d429ca324d87927ce18c2c676e048255">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec_trained</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://embed.tidymodels.org/reference/step_umap.html">step_umap</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span>, outcome <span class="op">=</span> <span class="st">"class"</span>, num_comp <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">plot_validation_results</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"UMAP (supervised)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/bean-umap-supervised_136e0d6c263fb73ebb86c157106cbd81">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/bean-umap-supervised-1.png" class="img-fluid figure-img" alt="Supervised UMAP component scores for the bean validation set, colored by class. There is again a very high degree of separation between clusters, and there are now fewer instances of one cluster containing multiple classes." width="672"></p>
<figcaption class="figure-caption">Supervised UMAP component scores for the bean validation set, colored by class</figcaption></figure>
</div>
</div>
</div>
<p>The supervised method shown in Figure @ref(fig:bean-umap-supervised) looks promising for modeling the data.</p>
<p>UMAP is a powerful method to reduce the feature space. However, it can be very sensitive to tuning parameters (e.g., the number of neighbors and so on). For this reason, it would help to experiment with a few of the parameters to assess how robust the results are for these data.</p>
</section></section><section id="sec-bean-models" class="level2" data-number="16.6"><h2 data-number="16.6" class="anchored" data-anchor-id="sec-bean-models">
<span class="header-section-number">16.6</span> Modeling</h2>
<p>Both the PLS and UMAP methods are worth investigating in conjunction with different models. Let’s explore a variety of different models with these dimensionality reduction techniques (along with no transformation at all): a single layer neural network, bagged trees, flexible discriminant analysis (FDA), naive Bayes, and regularized discriminant analysis (RDA).</p>
<p>Now that we are back in “modeling mode,” we’ll create a series of model specifications and then use a workflow set to tune the models in the following code. Note that the model parameters are tuned in conjunction with the recipe parameters (e.g., size of the reduced dimension, UMAP parameters).</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-models_649620a411b151e735cf59019be67a6d">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://baguette.tidymodels.org">baguette</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/discrim">discrim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mlp_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/mlp.html">mlp</a></span><span class="op">(</span>hidden_units <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>, penalty <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>, epochs <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">'nnet'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">'classification'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bagging_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/bag_tree.html">bag_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">'rpart'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">'classification'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fda_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/discrim_flexible.html">discrim_flexible</a></span><span class="op">(</span></span>
<span>    prod_degree <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">'earth'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rda_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/discrim_regularized.html">discrim_regularized</a></span><span class="op">(</span>frac_common_cov <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>, frac_identity <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">'klaR'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bayes_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html">naive_Bayes</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">'klaR'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need recipes for the dimensionality reduction methods we’ll try. Let’s start with a base recipe <code>bean_rec</code> and then extend it with different dimensionality reduction steps:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-recipes_a5365b1b177f96dd56120e534e8a44a8">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bean_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">bean_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://petersonr.github.io/bestNormalize/reference/step_orderNorm.html">step_orderNorm</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pls_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bean_rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pls.html">step_pls</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span>, outcome <span class="op">=</span> <span class="st">"class"</span>, num_comp <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">umap_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">bean_rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://embed.tidymodels.org/reference/step_umap.html">step_umap</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    outcome <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>    num_comp <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    neighbors <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    min_dist <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the <span class="pkg">workflowsets</span> package takes the preprocessors and models and crosses them. The <code>control</code> option <code>parallel_over</code> is set so that the parallel processing can work simultaneously across tuning parameter combinations. The <code>workflow_map()</code> function applies grid search to optimize the model/preprocessing parameters (if any) across 10 parameter combinations. The multiclass area under the ROC curve is estimated on the validation set.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-workflows_165d0a2b4ff88670df17b35234b975a6">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>parallel_over <span class="op">=</span> <span class="st">"everything"</span><span class="op">)</span></span>
<span><span class="va">bean_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">workflow_set</span><span class="op">(</span></span>
<span>    preproc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>basic <span class="op">=</span> <span class="va">class</span> <span class="op">~</span><span class="va">.</span>, pls <span class="op">=</span> <span class="va">pls_rec</span>, umap <span class="op">=</span> <span class="va">umap_rec</span><span class="op">)</span>, </span>
<span>    models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bayes <span class="op">=</span> <span class="va">bayes_spec</span>, fda <span class="op">=</span> <span class="va">fda_spec</span>,</span>
<span>                  rda <span class="op">=</span> <span class="va">rda_spec</span>, bag <span class="op">=</span> <span class="va">bagging_spec</span>,</span>
<span>                  mlp <span class="op">=</span> <span class="va">mlp_spec</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">workflow_map</span><span class="op">(</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1603</span>,</span>
<span>    resamples <span class="op">=</span> <span class="va">bean_val</span>,</span>
<span>    grid <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span>,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can rank the models by their validation set estimates of the area under the ROC curve:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-ranked_9557b7109453e340b7d9d091bfe9c6a7">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rankings</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rank_results</span><span class="op">(</span><span class="va">bean_res</span>, select_best <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="fu">map_chr</span><span class="op">(</span><span class="va">wflow_id</span>, <span class="op">~</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"_"</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rankings</span>, <span class="va">rank</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">rank</span>, <span class="va">mean</span>, <span class="va">model</span>, <span class="va">method</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 4</span></span>
<span><span class="co">##    rank  mean model               method</span></span>
<span><span class="co">##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt; </span></span>
<span><span class="co">## 1     1 0.996 mlp                 pls   </span></span>
<span><span class="co">## 2     2 0.996 discrim_regularized pls   </span></span>
<span><span class="co">## 3     3 0.995 discrim_flexible    basic </span></span>
<span><span class="co">## 4     4 0.995 naive_Bayes         pls   </span></span>
<span><span class="co">## 5     5 0.994 naive_Bayes         basic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Figure @ref(fig:dimensionality-rankings) illustrates this ranking.</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-rankings_5ba85d9130aebfec107b314f3d39ef74">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="16-dimensionality-reduction_files/figure-html/dimensionality-rankings-1.png" class="img-fluid figure-img" alt="Area under the ROC curve from the validation set. The three best model configurations use PLS together with regularized discriminant analysis, a multi-layer perceptron, and a naive Bayes model." width="672"></p>
<figcaption class="figure-caption">Area under the ROC curve from the validation set</figcaption></figure>
</div>
</div>
</div>
<p>It is clear from these results that most models give very good performance; there are few bad choices here. For demonstration, we’ll use the RDA model with PLS features as the final model. We will finalize the workflow with the numerically best parameters, fit it to the training set, then evaluate with the test set:</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-final_561862722924589c2e252b8da39f5260">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rda_res</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bean_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">extract_workflow</span><span class="op">(</span><span class="st">"pls_rda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">finalize_workflow</span><span class="op">(</span></span>
<span>    <span class="va">bean_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">extract_workflow_set_result</span><span class="op">(</span><span class="st">"pls_rda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">select_best</span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"roc_auc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">last_fit</span><span class="op">(</span>split <span class="op">=</span> <span class="va">bean_split</span>, metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rda_wflow_fit</span> <span class="op">&lt;-</span> <span class="fu">extract_workflow</span><span class="op">(</span><span class="va">rda_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What are the results for our metric (multiclass ROC AUC) on the testing set?</p>
<div class="cell" data-layout-align="center" data-hash="16-dimensionality-reduction_cache/html/dimensionality-test_65b460ff7cd31b06c3b3859f19df19ca">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">rda_res</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 4</span></span>
<span><span class="co">##   .metric .estimator .estimate .config             </span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">## 1 roc_auc hand_till      0.995 Preprocessor1_Model1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pretty good! We’ll use this model in the next chapter to demonstrate variable importance methods.</p>
</section><section id="sec-dimensionality-summary" class="level2" data-number="16.7"><h2 data-number="16.7" class="anchored" data-anchor-id="sec-dimensionality-summary">
<span class="header-section-number">16.7</span> Chapter Summary</h2>
<p>Dimensionality reduction can be a helpful method for exploratory data analysis as well as modeling. The <span class="pkg">recipes</span> and <span class="pkg">embed</span> packages contain steps for a variety of different methods and <span class="pkg">workflowsets</span> facilitates choosing an appropriate method for a data set. This chapter also discussed how recipes can be used on their own, either for debugging problems with a recipe or directly for exploratory data analysis and data visualization.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-beans" class="csl-entry" role="listitem">
Koklu, M, and IA Ozkan. 2020. <span>“Multiclass Classification of Dry Beans Using Computer Vision and Machine Learning Techniques.”</span> <em>Computers and Electronics in Agriculture</em> 174: 105507.
</div>
<div id="ref-fes" class="csl-entry" role="listitem">
Kuhn, M, and K Johnson. 2020. <em>Feature Engineering and Selection: A Practical Approach for Predictive Models</em>. CRC Press.
</div>
<div id="ref-mcinnes2020umap" class="csl-entry" role="listitem">
McInnes, L, J Healy, and J Melville. 2020. <span>“UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction.”</span>
</div>
<div id="ref-Mingqiang08" class="csl-entry" role="listitem">
Mingqiang, Y, K Kidiyo, and R Joseph. 2008. <span>“A Survey of Shape Feature Extraction Techniques.”</span> In <em>Pattern Recognition</em>, edited by PY Yin. Rijeka: IntechOpen. <a href="https://doi.org/10.5772/6237">https://doi.org/10.5772/6237</a>.
</div>
<div id="ref-symons1988211" class="csl-entry" role="listitem">
Symons, S, and RG Fulcher. 1988. <span>“Determination of Wheat Kernel Morphological Variation by Digital Image Analysis: <span>I</span>. <span>Variation</span> in Eastern Canadian Milling Quality Wheats.”</span> <em>Journal of Cereal Science</em> 8 (3): 211–18.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>The <span class="pkg">learntidymodels</span> package can be found at its GitHub site: <a href="https://github.com/tidymodels/learntidymodels" class="uri">https://github.com/tidymodels/learntidymodels</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The <span class="pkg">mixOmics</span> package is not available on CRAN, but instead on Bioconductor: <a href="https://doi.org/doi:10.18129/B9.bioc.mixOmics" class="uri">https://doi.org/doi:10.18129/B9.bioc.mixOmics</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./15-workflow-sets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./17-encoding-categorical-data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Encoding Categorical Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Modelado Ordenado con R fue escrito por Max Kuhn, y Julia Silge.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>