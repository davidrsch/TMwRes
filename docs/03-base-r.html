<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Max Kuhn, y Julia Silge">
<title>Modelado Ordenado con R - 3&nbsp; A Review of R Modeling Fundamentals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-ames.html" rel="next">
<link href="./02-tidyverse.html" rel="prev">
<link href="./images/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="TMwR.css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-software-modeling.html">INTRODUCTION</a></li><li class="breadcrumb-item"><a href="./03-base-r.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelado Ordenado con R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidrsch/TMwRes" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello World</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">INTRODUCTION</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-software-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Software for modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Tidyverse Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-base-r.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">MODELING BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ames Housing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-spending.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spending our Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-fitting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fitting Models with parsnip</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-the-model-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">A Model Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Feature Engineering with recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-judging-model-effectiveness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Judging Model Effectiveness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">TOOLS FOR CREATING EFFECTIVE MODELS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Resampling for Evaluating Performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-comparing-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tuning-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Tuning and the Dangers of Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-grid-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-iterative-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-workflow-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">BEYOND THE BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-dimensionality-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-encoding-categorical-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Encoding Categorical Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-explaining-models-and-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Explaining Models and Predictions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-when-should-you-trust-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">When Should You Trust Your Predictions?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-ensemble-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembles of Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-inferential-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Inferential Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pre-proc-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Recommended Preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#an-example" id="toc-an-example" class="nav-link active" data-scroll-target="#an-example"><span class="header-section-number">3.1</span> An Example</a></li>
  <li><a href="#formula" id="toc-formula" class="nav-link" data-scroll-target="#formula"><span class="header-section-number">3.2</span> What Does the R Formula Do?</a></li>
  <li><a href="#tidiness-modeling" id="toc-tidiness-modeling" class="nav-link" data-scroll-target="#tidiness-modeling"><span class="header-section-number">3.3</span> Why Tidiness Is Important for Modeling</a></li>
  <li><a href="#combining-base-r-models-and-the-tidyverse" id="toc-combining-base-r-models-and-the-tidyverse" class="nav-link" data-scroll-target="#combining-base-r-models-and-the-tidyverse"><span class="header-section-number">3.4</span> Combining Base R Models and the Tidyverse</a></li>
  <li><a href="#the-tidymodels-metapackage" id="toc-the-tidymodels-metapackage" class="nav-link" data-scroll-target="#the-tidymodels-metapackage"><span class="header-section-number">3.5</span> The tidymodels Metapackage</a></li>
  <li><a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary"><span class="header-section-number">3.6</span> Chapter Summary</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/davidrsch/TMwRes/edit/main/03-base-r.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/davidrsch/TMwRes/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-base-r" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Before describing how to use tidymodels for applying tidy data principles to building models with R, let’s review how models are created, trained, and used in the core R language (often called “base R”). This chapter is a brief illustration of core language conventions that are important to be aware of even if you never use base R for models at all. This chapter is not exhaustive, but it provides readers (especially those new to R) the basic, most commonly used motifs.</p>
<p>The S language, on which R is based, has had a rich data analysis environment since the publication of <span class="citation" data-cites="WhiteBook">Chambers and Hastie (<a href="references.html#ref-WhiteBook" role="doc-biblioref">1992</a>)</span> (commonly known as The White Book). This version of S introduced standard infrastructure components familiar to R users today, such as symbolic model formulae, model matrices, and data frames, as well as standard object-oriented programming methods for data analysis. These user interfaces have not substantively changed since then.</p>
<section id="an-example" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="an-example">
<span class="header-section-number">3.1</span> An Example</h2>
<p>To demonstrate some fundamentals for modeling in base R, let’s use experimental data from <span class="citation" data-cites="mcdonald2009">McDonald (<a href="references.html#ref-mcdonald2009" role="doc-biblioref">2009</a>)</span>, by way of <span class="citation" data-cites="mangiafico2015">Mangiafico (<a href="references.html#ref-mangiafico2015" role="doc-biblioref">2015</a>)</span>, on the relationship between the ambient temperature and the rate of cricket chirps per minute. Data were collected for two species: <em>O. exclamationis</em> and <em>O. niveus</em>. The data are contained in a data frame called <code>crickets</code> with a total of 31 data points. These data are shown in <a href="#fig-cricket-plot">Figure&nbsp;<span>3.1</span></a> using the following <span class="pkg">ggplot2</span> code.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crickets</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">crickets</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the temperature on the x-axis, the chirp rate on the y-axis. The plot</span></span>
<span><span class="co"># elements will be colored differently for each species:</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crickets</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp</span>, y <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">species</span>, pch <span class="op">=</span> <span class="va">species</span>, lty <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># Plot points for each data point and color by species</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># Show a simple linear model fit created separately for each species:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Temperature (C)"</span>, y <span class="op">=</span> <span class="st">"Chirp Rate (per minute)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<pre><code>## [1] "species" "temp"    "rate"</code></pre>
<div class="cell-output-display">
<div id="fig-cricket-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-cricket-plot-1.png" class="img-fluid figure-img" style="width:70.0%" alt="A scatter plot of the chirp rate and temperature for two different species of crickets with linear trend lines per species. The trends are linearly increasing with a separation between the two species."></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Relationship between chirp rate and temperature for two different species of crickets</figcaption></figure>
</div>
</div>
</div>
<p>The data exhibit fairly linear trends for each species. For a given temperature, <em>O. exclamationis</em> appears to chirp more per minute than the other species. For an inferential model, the researchers might have specified the following null hypotheses prior to seeing the data:</p>
<ul>
<li><p>Temperature has no effect on the chirp rate.</p></li>
<li><p>There are no differences between the species’ chirp rate.</p></li>
</ul>
<p>There may be some scientific or practical value in predicting the chirp rate but in this example we will focus on inference.</p>
<p>To fit an ordinary linear model in R, the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function is commonly used. The important arguments to this function are a model formula and a data frame that contains the data. The formula is <em>symbolic</em>. For example, the simple formula:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>specifies that the chirp rate is the outcome (since it is on the left-hand side of the tilde <code>~</code>) and that the temperature value is the predictor.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Suppose the data contained the time of day in which the measurements were obtained in a column called <code>time</code>. The formula:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would not add the time and temperature values together. This formula would symbolically represent that temperature and time should be added as separate <em>main effects</em> to the model. A main effect is a model term that contains a single predictor variable.</p>
<p>There are no time measurements in these data but the species can be added to the model in the same way:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">species</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Species is not a quantitative variable; in the data frame, it is represented as a factor column with levels <code>"O. exclamationis"</code> and <code>"O. niveus"</code>. The vast majority of model functions cannot operate on nonnumeric data. For species, the model needs to encode the species data in a numeric format. The most common approach is to use indicator variables (also known as dummy variables) in place of the original qualitative values. In this instance, since species has two possible values, the model formula will automatically encode this column as numeric by adding a new column that has a value of zero when the species is <code>"O. exclamationis"</code> and a value of one when the data correspond to <code>"O. niveus"</code>. The underlying formula machinery automatically converts these values for the data set used to create the model, as well as for any new data points (for example, when the model is used for prediction).</p>
<div class="rmdnote">
<p>Suppose there were five species instead of two. The model formula, in this case, would create four binary columns that are binary indicators for four of the species. The <em>reference level</em> of the factor (i.e., the first level) is always left out of the predictor set. The idea is that, if you know the values of the four indicator variables, the value of the species can be determined. We discuss binary indicator variables in more detail in <span class="quarto-unresolved-ref">?sec-dummies</span>.</p>
</div>
<p>The model formula <code>rate ~ temp + species</code> creates a model with different y-intercepts for each species; the slopes of the regression lines could be different for each species as well. To accommodate this structure, an interaction term can be added to the model. This can be specified in a few different ways, and the most basic uses the colon:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">species</span> <span class="op">+</span> <span class="va">temp</span><span class="op">:</span><span class="va">species</span></span>
<span></span>
<span><span class="co"># A shortcut can be used to expand all interactions containing</span></span>
<span><span class="co"># interactions with two variables:</span></span>
<span><span class="va">rate</span> <span class="op">~</span> <span class="op">(</span><span class="va">temp</span> <span class="op">+</span> <span class="va">species</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Another shortcut to expand factors to include all possible</span></span>
<span><span class="co"># interactions (equivalent for this example):</span></span>
<span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">*</span> <span class="va">species</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In addition to the convenience of automatically creating indicator variables, the formula offers a few other niceties:</p>
<ul>
<li><p><em>In-line</em> functions can be used in the formula. For example, to use the natural log of the temperature, we can create the formula <code>rate ~ log(temp)</code>. Since the formula is symbolic by default, literal math can also be applied to the predictors using the identity function <code><a href="https://rdrr.io/r/base/AsIs.html">I()</a></code>. To use Fahrenheit units, the formula could be <code>rate ~ I( (temp * 9/5) + 32 )</code> to convert from Celsius.</p></li>
<li><p>R has many functions that are useful inside of formulas. For example, <code>poly(x, 3)</code> adds linear, quadratic, and cubic terms for <code>x</code> to the model as main effects. The <span class="pkg">splines</span> package also has several functions to create nonlinear spline terms in the formula.</p></li>
<li><p>For data sets where there are many predictors, the period shortcut is available. The period represents main effects for all of the columns that are not on the left-hand side of the tilde. Using <code>~ (.)^3</code> would add main effects as well as all two- and three-variable interactions to the model.</p></li>
</ul>
<p>Returning to our chirping crickets, let’s use a two-way interaction model. In this book, we use the suffix <code>_fit</code> for R objects that are fitted models.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">interaction_fit</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">~</span> <span class="op">(</span><span class="va">temp</span> <span class="op">+</span> <span class="va">species</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, data <span class="op">=</span> <span class="va">crickets</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># To print a short summary of the model:</span></span>
<span><span class="va">interaction_fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = rate ~ (temp + species)^2, data = crickets)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##           (Intercept)                   temp       speciesO. niveus  </span></span>
<span><span class="co">##               -11.041                  3.751                 -4.348  </span></span>
<span><span class="co">## temp:speciesO. niveus  </span></span>
<span><span class="co">##                -0.234</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This output is a little hard to read. For the species indicator variables, R mashes the variable name (<code>species</code>) together with the factor level (<code>O. niveus</code>) with no delimiter.</p>
<p>Before going into any inferential results for this model, the fit should be assessed using diagnostic plots. We can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method for <code>lm</code> objects. This method produces a set of four plots for the object, each showing different aspects of the fit, as shown in Figure <a href="#fig-interaction-plots">Figure&nbsp;<span>3.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Place two plots next to one another:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show residuals vs predicted values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">interaction_fit</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A normal quantile plot on the residuals:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">interaction_fit</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-interaction-plots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-interaction-plots-1.png" class="img-fluid figure-img" style="width:100.0%" alt="On the left is a scatter plot of the model residuals versus predicted values. There are no strong trends in the data. The right-hand panel shows a normal quantile-quantile plot where the points indicate that normality is probably a good assumption."></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Residual diagnostic plots for the linear model with interactions, which appear reasonable enough to conduct inferential analysis</figcaption></figure>
</div>
</div>
</div>
<div class="rmdnote">
<p>When it comes to the technical details of evaluating expressions, R is <em>lazy</em> (as opposed to eager). This means that model fitting functions typically compute the minimum possible quantities at the last possible moment. For example, if you are interested in the coefficient table for each model term, this is not automatically computed with the model but is instead computed via the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method.</p>
</div>
<p>Our next order of business with the crickets is to assess if the inclusion of the interaction term is necessary. The most appropriate approach for this model is to recompute the model without the interaction term and use the <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit a reduced model:</span></span>
<span><span class="va">main_effect_fit</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">crickets</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Compare the two:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">main_effect_fit</span>, <span class="va">interaction_fit</span><span class="op">)</span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: rate ~ temp + species</span></span>
<span><span class="co">## Model 2: rate ~ (temp + species)^2</span></span>
<span><span class="co">##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">## 1     28 89.3                         </span></span>
<span><span class="co">## 2     27 85.1  1      4.28 1.36   0.25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This statistical test generates a p-value of 0.25. This implies that there is a lack of evidence against the null hypothesis that the interaction term is not needed by the model. For this reason, we will conduct further analysis on the model without the interaction.</p>
<p>Residual plots should be reassessed to make sure that our theoretical assumptions are valid enough to trust the p-values produced by the model (plots not shown here but spoiler alert: they are).</p>
<p>We can use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> method to inspect the coefficients, standard errors, and p-values of each model term:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">main_effect_fit</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = rate ~ temp + species, data = crickets)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -3.013 -1.130 -0.391  0.965  3.780 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)       -7.2109     2.5509   -2.83   0.0086 ** </span></span>
<span><span class="co">## temp               3.6028     0.0973   37.03  &lt; 2e-16 ***</span></span>
<span><span class="co">## speciesO. niveus -10.0653     0.7353  -13.69  6.3e-14 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.79 on 28 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.99,   Adjusted R-squared:  0.989 </span></span>
<span><span class="co">## F-statistic: 1.33e+03 on 2 and 28 DF,  p-value: &lt;2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The chirp rate for each species increases by 3.6 chirps as the temperature increases by a single degree. This term shows strong statistical significance as evidenced by the p-value. The species term has a value of -10.07. This indicates that, across all temperature values, <em>O. niveus</em> has a chirp rate that is about 10 fewer chirps per minute than <em>O. exclamationis</em>. Similar to the temperature term, the species effect is associated with a very small p-value.</p>
<p>The only issue in this analysis is the intercept value. It indicates that at 0° C, there are negative chirps per minute for both species. While this doesn’t make sense, the data only go as low as 17.2° C and interpreting the model at 0° C would be an extrapolation. This would be a bad idea. That being said, the model fit is good within the <em>applicable range</em> of the temperature values; the conclusions should be limited to the observed temperature range.</p>
<p>If we needed to estimate the chirp rate at a temperature that was not observed in the experiment, we could use the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> method. It takes the model object and a data frame of new values for prediction. For example, the model estimates the chirp rate for <em>O. exclamationis</em> for temperatures between 15° C and 20° C can be computed via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"O. exclamationis"</span>, temp <span class="op">=</span> <span class="fl">15</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">main_effect_fit</span>, <span class="va">new_values</span><span class="op">)</span></span>
<span><span class="co">##     1     2     3     4     5     6 </span></span>
<span><span class="co">## 46.83 50.43 54.04 57.64 61.24 64.84</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdwarning">
<p>Note that the non-numeric value of <code>species</code> is passed to the predict method, as opposed to the numeric, binary indicator variable.</p>
</div>
<p>While this analysis has obviously not been an exhaustive demonstration of R’s modeling capabilities, it does highlight some major features important for the rest of this book:</p>
<ul>
<li><p>The language has an expressive syntax for specifying model terms for both simple and quite complex models.</p></li>
<li><p>The R formula method has many conveniences for modeling that are also applied to new data when predictions are generated.</p></li>
<li><p>There are numerous helper functions (e.g., <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>) that you can use to conduct specific calculations after the fitted model is created.</p></li>
</ul>
<p>Finally, as previously mentioned, this framework was first published in 1992. Most of these ideas and methods were developed in that period but have remained remarkably relevant to this day. It highlights that the S language and, by extension R, has been designed for data analysis since its inception.</p>
</section><section id="formula" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="formula">
<span class="header-section-number">3.2</span> What Does the R Formula Do?</h2>
<p>The R model formula is used by many modeling packages. It usually serves multiple purposes:</p>
<ul>
<li><p>The formula defines the columns that the model uses.</p></li>
<li><p>The standard R machinery uses the formula to encode the columns into an appropriate format.</p></li>
<li><p>The roles of the columns are defined by the formula.</p></li>
</ul>
<p>For the most part, practitioners’ understanding of what the formula does is dominated by the last purpose. Our focus when typing out a formula is often to declare how the columns should be used. For example, the previous specification we discussed sets up predictors to be used in a specific way:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">temp</span> <span class="op">+</span> <span class="va">species</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our focus, when seeing this, is that there are two predictors and the model should contain their main effects and the two-way interactions. However, this formula also implies that, since <code>species</code> is a factor, it should also create indicator variable columns for this predictor (see <span class="quarto-unresolved-ref">?sec-dummies</span>) and multiply those columns by the <code>temp</code> column to create the interactions. This transformation represents our second bullet point on encoding; the formula also defines how each column is encoded and can create additional columns that are not in the original data.</p>
<div class="rmdwarning">
<p>This is an important point that will come up multiple times in this text, especially when we discuss more complex feature engineering in <span class="quarto-unresolved-ref">?sec-recipes</span> and beyond. The formula in R has some limitations, and our approaches to overcoming them contend with all three aspects.</p>
</div>
</section><section id="tidiness-modeling" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="tidiness-modeling">
<span class="header-section-number">3.3</span> Why Tidiness Is Important for Modeling</h2>
<p>One of the strengths of R is that it encourages developers to create a user interface that fits their needs. As an example, here are three common methods for creating a scatter plot of two numeric variables in a data frame called <code>plot_data</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">x</span>, <span class="va">plot_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html">xyplot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In these three cases, separate groups of developers devised three distinct interfaces for the same task. Each has advantages and disadvantages.</p>
<p>In comparison, the <em>Python Developer’s Guide</em> espouses the notion that, when approaching a problem:</p>
<blockquote class="blockquote">
<p>“There should be one – and preferably only one – obvious way to do it.”</p>
</blockquote>
<p>R is quite different from Python in this respect. An advantage of R’s diversity of interfaces is that it can evolve over time and fit different needs for different users.</p>
<p>Unfortunately, some of the syntactical diversity is due to a focus on the needs of the person <em>developing</em> the code instead of the needs of the person <em>using</em> the code. Inconsistencies among packages can be a stumbling block for R users.</p>
<p>Suppose your modeling project has an outcome with two classes. There are a variety of statistical and machine learning models you could choose from. In order to produce a class probability estimate for each sample, it is common for a model function to have a corresponding <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> method. However, there is significant heterogeneity in the argument values used by those methods to make class probability predictions; this heterogeneity can be difficult for even experienced users to navigate. A sampling of these argument values for different models is shown in <a href="#tbl-probability-args">Table&nbsp;<span>3.1</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="tbl-probability-args" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.1: Heterogeneous argument names for different modeling functions.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Function</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Package</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Code</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-family: monospace;">lda()</td>
<td style="text-align: left;">MASS</td>
<td style="text-align: left; font-family: monospace;">predict(object)</td>
</tr>
<tr class="even">
<td style="text-align: left; font-family: monospace;">glm()</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "response")</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-family: monospace;">gbm()</td>
<td style="text-align: left;">gbm</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "response", n.trees)</td>
</tr>
<tr class="even">
<td style="text-align: left; font-family: monospace;">mda()</td>
<td style="text-align: left;">mda</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "posterior")</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-family: monospace;">rpart()</td>
<td style="text-align: left;">rpart</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "prob")</td>
</tr>
<tr class="even">
<td style="text-align: left;">various</td>
<td style="text-align: left;">RWeka</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "probability")</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-family: monospace;">logitboost()</td>
<td style="text-align: left;">LogitBoost</td>
<td style="text-align: left; font-family: monospace;">predict(object, type = "raw", nIter)</td>
</tr>
<tr class="even">
<td style="text-align: left; font-family: monospace;">pamr.train()</td>
<td style="text-align: left;">pamr</td>
<td style="text-align: left; font-family: monospace;">pamr.predict(object, type = "posterior")</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note that the last example has a custom function to make predictions instead of using the more common <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> interface (the generic <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> method). This lack of consistency is a barrier to day-to-day usage of R for modeling.</p>
<p>As another example of unpredictability, the R language has conventions for missing data that are handled inconsistently. The general rule is that missing data propagate more missing data; the average of a set of values with a missing data point is itself missing and so on. When models make predictions, the vast majority require all of the predictors to have complete values. There are several options baked in to R at this point with the generic function <code><a href="https://rdrr.io/r/stats/na.action.html">na.action()</a></code>. This sets the policy for how a function should behave if there are missing values. The two most common policies are <code><a href="https://rdrr.io/r/stats/na.fail.html">na.fail()</a></code> and <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code>. The former produces an error if missing data are present while the latter removes the missing data prior to calculations by case-wise deletion. From our previous example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add a missing value to the prediction set</span></span>
<span><span class="va">new_values</span><span class="op">$</span><span class="va">temp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># The predict method for `lm` defaults to `na.pass`:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">main_effect_fit</span>, <span class="va">new_values</span><span class="op">)</span></span>
<span><span class="co">##     1     2     3     4     5     6 </span></span>
<span><span class="co">##    NA 50.43 54.04 57.64 61.24 64.84</span></span>
<span></span>
<span><span class="co"># Alternatively </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">main_effect_fit</span>, <span class="va">new_values</span>, na.action <span class="op">=</span> <span class="va">na.fail</span><span class="op">)</span></span>
<span><span class="co">## Error in na.fail.default(structure(list(temp = c(NA, 16L, 17L, 18L, 19L, : missing values in object</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">main_effect_fit</span>, <span class="va">new_values</span>, na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span></span>
<span><span class="co">##     2     3     4     5     6 </span></span>
<span><span class="co">## 50.43 54.04 57.64 61.24 64.84</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From a user’s point of view, <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> can be problematic. In our example, <code>new_values</code> has 6 rows but only 5 would be returned with <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code>. To adjust for this, the user would have to determine which row had the missing value and interleave a missing value in the appropriate place if the predictions were merged into <code>new_values</code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> While it is rare that a prediction function uses <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> as its missing data policy, this does occur. Users who have determined this as the cause of an error in their code find it quite memorable.</p>
<p>To resolve the usage issues described here, the tidymodels packages have a set of design goals. Most of the tidymodels design goals fall under the existing rubric of “Design for Humans” from the tidyverse <span class="citation" data-cites="tidyverse">(<a href="references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>, but with specific applications for modeling code. There are a few additional tidymodels design goals that complement those of the tidyverse. Some examples:</p>
<ul>
<li><p>R has excellent capabilities for object-oriented programming, and we use this in lieu of creating new function names (such as a hypothetical new <code>predict_samples()</code> function).</p></li>
<li><p><em>Sensible defaults</em> are very important. Also, functions should have no default for arguments when it is more appropriate to force the user to make a choice (e.g., the file name argument for <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>).</p></li>
<li><p>Similarly, argument values whose default can be derived from the data should be. For example, for <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> the <code>family</code> argument could check the type of data in the outcome and, if no <code>family</code> was given, a default could be determined internally.</p></li>
<li><p>Functions should take the <em>data structures that users have</em> as opposed to the data structure that developers want. For example, a model function’s only interface should not be constrained to matrices. Frequently, users will have non-numeric predictors such as factors.</p></li>
</ul>
<p>Many of these ideas are described in the tidymodels guidelines for model implementation.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> In subsequent chapters, we will illustrate examples of existing issues, along with their solutions.</p>
<div class="rmdnote">
<p>A few existing R packages provide a unified interface to harmonize these heterogeneous modeling APIs, such as <span class="pkg">caret</span> and <span class="pkg">mlr</span>. The tidymodels framework is similar to these in adopting a unification of the function interface, as well as enforcing consistency in the function names and return values. It is different in its opinionated design goals and modeling implementation, discussed in detail throughout this book.</p>
</div>
<p>The <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> function, which we use throughout this book, is another tool for standardizing the structure of R objects. It can return many types of R objects in a more usable format. For example, suppose that predictors are being screened based on their correlation to the outcome column. Using <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>, the results from <code><a href="https://rdrr.io/r/stats/cor.test.html">cor.test()</a></code> can be returned in a list for each predictor:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">corr_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">mpg</span><span class="op">)</span>, <span class="va">cor.test</span>, y <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The first of ten results in the vector: </span></span>
<span><span class="va">corr_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  .x[[i]] and mtcars$mpg</span></span>
<span><span class="co">## t = -8.9, df = 30, p-value = 6e-10</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -0.9258 -0.7163</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##     cor </span></span>
<span><span class="co">## -0.8522</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to use these results in a plot, the standard format of hypothesis test results are not very useful. The <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> method can return this as a tibble with standardized names:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">corr_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   estimate statistic  p.value parameter conf.low conf.high method        alternative</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      </span></span>
<span><span class="co">## 1   -0.852     -8.92 6.11e-10        30   -0.926    -0.716 Pearson's pr… two.sided</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These results can be “stacked” and added to a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, as shown in <a href="#fig-corr-plot">Figure&nbsp;<span>3.3</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">corr_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Convert each to a tidy format; `map_dfr()` stacks the data frames </span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">tidy</span>, .id <span class="op">=</span> <span class="st">"predictor"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">predictor</span>, <span class="va">estimate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Correlation with mpg"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-corr-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/fig-corr-plot-1.png" class="img-fluid figure-img" alt="A plot of the correlations (and 95% confidence intervals) between predictors and the outcome in the `mtcars` data set. None of the intervals overlap with zero. The car weight had the largest negative correlation and the rear axle ratio has the highest positive correlation." width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Correlations (and 95% confidence intervals) between predictors and the outcome in the <code>mtcars</code> data set</figcaption></figure>
</div>
</div>
</div>
<p>Creating such a plot is possible using core R language functions, but automatically reformatting the results makes for more concise code with less potential for errors.</p>
</section><section id="combining-base-r-models-and-the-tidyverse" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="combining-base-r-models-and-the-tidyverse">
<span class="header-section-number">3.4</span> Combining Base R Models and the Tidyverse</h2>
<p>R modeling functions from the core language or other R packages can be used in conjunction with the tidyverse, especially with the <span class="pkg">dplyr</span>, <span class="pkg">purrr</span>, and <span class="pkg">tidyr</span> packages. For example, if we wanted to fit separate models for each cricket species, we can first break out the cricket data by this column using <code><a href="https://dplyr.tidyverse.org/reference/group_nest.html">dplyr::group_nest()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">split_by_species</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">crickets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> </span>
<span><span class="va">split_by_species</span></span>
<span><span class="co">## # A tibble: 2 × 2</span></span>
<span><span class="co">##   species                        data</span></span>
<span><span class="co">##   &lt;fct&gt;            &lt;list&lt;tibble[,2]&gt;&gt;</span></span>
<span><span class="co">## 1 O. exclamationis           [14 × 2]</span></span>
<span><span class="co">## 2 O. niveus                  [17 × 2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>data</code> column contains the <code>rate</code> and <code>temp</code> columns from <code>crickets</code> in a <em>list column</em>. From this, the <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> function can create individual models for each species:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_by_species</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">split_by_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">~</span> <span class="va">temp</span>, data <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model_by_species</span></span>
<span><span class="co">## # A tibble: 2 × 3</span></span>
<span><span class="co">##   species                        data model </span></span>
<span><span class="co">##   &lt;fct&gt;            &lt;list&lt;tibble[,2]&gt;&gt; &lt;list&gt;</span></span>
<span><span class="co">## 1 O. exclamationis           [14 × 2] &lt;lm&gt;  </span></span>
<span><span class="co">## 2 O. niveus                  [17 × 2] &lt;lm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To collect the coefficients for each of these models, use <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> to convert them to a consistent data frame format so that they can be unnested:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_by_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">tidy</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">coef</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 6</span></span>
<span><span class="co">##   species          term        estimate std.error statistic  p.value</span></span>
<span><span class="co">##   &lt;fct&gt;            &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 O. exclamationis (Intercept)   -11.0      4.77      -2.32 3.90e- 2</span></span>
<span><span class="co">## 2 O. exclamationis temp            3.75     0.184     20.4  1.10e-10</span></span>
<span><span class="co">## 3 O. niveus        (Intercept)   -15.4      2.35      -6.56 9.07e- 6</span></span>
<span><span class="co">## 4 O. niveus        temp            3.52     0.105     33.6  1.57e-15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdnote">
<p>List columns can be very powerful in modeling projects. List columns provide containers for any type of R objects, from a fitted model itself to the important data frame structure.</p>
</div>
</section><section id="the-tidymodels-metapackage" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="the-tidymodels-metapackage">
<span class="header-section-number">3.5</span> The tidymodels Metapackage</h2>
<p>The tidyverse (<a href="02-tidyverse.html">Chapter&nbsp;<span>2</span></a>) is designed as a set of modular R packages, each with a fairly narrow scope. The tidymodels framework follows a similar design. For example, the <span class="pkg">rsample</span> package focuses on data splitting and resampling. Although resampling methods are critical to other activities of modeling (e.g., measuring performance), they reside in a single package, and performance metrics are contained in a different, separate package, <span class="pkg">yardstick</span>. There are many benefits to adopting this philosophy of modular packages, from less bloated model deployment to smoother package maintenance.</p>
<p>The downside to this philosophy is that there are a lot of packages in the tidymodels framework. To compensate for this, the tidymodels <em>package</em> (which you can think of as a metapackage like the tidyverse package) loads a core set of tidymodels and tidyverse packages. Loading the package shows which packages are attached:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">## ── Attaching packages ─────────────────────────────────────────── tidymodels 1.1.1 ──</span></span>
<span><span class="co">## ✔ broom        1.0.5     ✔ recipes      1.0.8</span></span>
<span><span class="co">## ✔ dials        1.2.0     ✔ rsample      1.2.0</span></span>
<span><span class="co">## ✔ dplyr        1.1.3     ✔ tibble       3.2.1</span></span>
<span><span class="co">## ✔ ggplot2      3.4.3     ✔ tidyr        1.3.0</span></span>
<span><span class="co">## ✔ infer        1.0.5     ✔ tune         1.1.2</span></span>
<span><span class="co">## ✔ modeldata    1.2.0     ✔ workflows    1.1.3</span></span>
<span><span class="co">## ✔ parsnip      1.1.1     ✔ workflowsets 1.0.1</span></span>
<span><span class="co">## ✔ purrr        1.0.2     ✔ yardstick    1.2.0</span></span>
<span><span class="co">## ── Conflicts ────────────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">## ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">## ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">## ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="co">## • Dig deeper into tidy modeling with R at https://www.tmwr.org</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you have used the tidyverse, you’ll notice some familiar names as a few tidyverse packages, such as <span class="pkg">dplyr</span> and <span class="pkg">ggplot2</span>, are loaded together with the tidymodels packages. We’ve already said that the tidymodels framework applies tidyverse principles to modeling, but the tidymodels framework also literally builds on some of the most fundamental tidyverse packages such as these.</p>
<p>Loading the metapackage also shows if there are function naming conflicts with previously loaded packages. As an example of a naming conflict, before loading <span class="pkg">tidymodels</span>, invoking the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function will execute the function in the <span class="pkg">stats</span> package. After loading tidymodels, it will execute the <span class="pkg">dplyr</span> function of the same name.</p>
<p>There are a few ways to handle naming conflicts. The function can be called with its namespace (e.g., <code><a href="https://rdrr.io/r/stats/filter.html">stats::filter()</a></code>). This is not bad practice, but it does make the code less readable.</p>
<p>Another option is to use the <span class="pkg">conflicted</span> package. We can set a rule that remains in effect until the end of the R session to ensure that one specific function will always run if no namespace is given in the code. As an example, if we prefer the <span class="pkg">dplyr</span> version of the previous function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/">conflicted</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, winner <span class="op">=</span> <span class="st">"dplyr"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For convenience, <span class="pkg">tidymodels</span> contains a function that captures most of the common naming conflicts that we might encounter:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [conflicted] Will prefer agua::refit over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dials::Laplace over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dials::max_rules over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dials::neighbors over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dials::prune over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dials::smoothness over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::collapse over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::combine over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::filter over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::rename over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::select over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer dplyr::slice over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer ggplot2::`%+%` over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer ggplot2::margin over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer parsnip::bart over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer parsnip::fit over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer parsnip::mars over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer parsnip::pls over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer purrr::cross over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer purrr::invoke over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer purrr::map over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer recipes::discretize over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer recipes::step over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer rsample::populate over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer scales::rescale over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer themis::step_downsample over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer themis::step_upsample over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tidyr::expand over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tidyr::extract over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tidyr::pack over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tidyr::unpack over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tune::parameters over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer tune::tune over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer yardstick::get_weights over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer yardstick::precision over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer yardstick::recall over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer yardstick::spec over any other package.</span></span>
<span><span class="co">## [conflicted] Will prefer recipes::update over Matrix::update.</span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────────────── tidymodels_prefer() ──</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="rmdwarning">
<p>Be aware that using this function opts you in to using <code><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html">conflicted::conflict_prefer()</a></code> for all namespace conflicts, making every conflict an error and forcing you to choose which function to use. The function <code><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels::tidymodels_prefer()</a></code> handles the most common conflicts from tidymodels functions, but you will need to handle other conflicts in your R session yourself.</p>
</div>
</section><section id="chapter-summary" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="chapter-summary">
<span class="header-section-number">3.6</span> Chapter Summary</h2>
<p>This chapter reviewed core R language conventions for creating and using models that are an important foundation for the rest of this book. The formula operator is an expressive and important aspect of fitting models in R and often serves multiple purposes in non-tidymodels functions. Traditional R approaches to modeling have some limitations, especially when it comes to fluently handling and visualizing model output. The <span class="pkg">tidymodels</span> metapackage applies tidyverse design philosophy to modeling packages.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-WhiteBook" class="csl-entry" role="listitem">
Chambers, J, and T Hastie, eds. 1992. <em>Statistical Models in <span>S</span></em>. Boca Raton, FL: CRC Press, Inc.
</div>
<div id="ref-mangiafico2015" class="csl-entry" role="listitem">
Mangiafico, S. 2015. <span>“An <span>R</span> Companion for the Handbook of Biological Statistics.”</span> <a href="https://rcompanion.org/handbook/" class="uri">https://rcompanion.org/handbook/</a>.
</div>
<div id="ref-mcdonald2009" class="csl-entry" role="listitem">
McDonald, J. 2009. <em>Handbook of Biological Statistics</em>. Sparky House Publishing.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, H, M Averick, J Bryan, W Chang, L McGowan, R François, G Grolemund, et al. 2019. <span>“Welcome to the <span>Tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43).
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Most model functions implicitly add an intercept column.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>A base R policy called <code><a href="https://rdrr.io/r/stats/na.fail.html">na.exclude()</a></code> does exactly this.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://tidymodels.github.io/model-implementation-principles" class="uri">https://tidymodels.github.io/model-implementation-principles</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-tidyverse.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Tidyverse Primer</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-ames.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ames Housing Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Modelado Ordenado con R fue escrito por Max Kuhn, y Julia Silge.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>