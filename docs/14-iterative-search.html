<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Max Kuhn, y Julia Silge">
<title>Modelado Ordenado con R - 14&nbsp; Iterative Search</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./15-workflow-sets.html" rel="next">
<link href="./13-grid-search.html" rel="prev">
<link href="./images/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="TMwR.css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-resampling.html">TOOLS FOR CREATING EFFECTIVE MODELS</a></li><li class="breadcrumb-item"><a href="./14-iterative-search.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelado Ordenado con R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidrsch/TMwRes" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello World</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">INTRODUCTION</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-software-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Software for modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Tidyverse Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-base-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Review of R Modeling Fundamentals</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">MODELING BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ames Housing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-spending.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spending our Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-fitting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fitting Models with parsnip</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-the-model-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">A Model Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Feature Engineering with recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-judging-model-effectiveness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Judging Model Effectiveness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">TOOLS FOR CREATING EFFECTIVE MODELS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Resampling for Evaluating Performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-comparing-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing Models with Resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tuning-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Tuning and the Dangers of Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-grid-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Grid Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-iterative-search.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-workflow-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">BEYOND THE BASICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-dimensionality-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-encoding-categorical-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Encoding Categorical Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-explaining-models-and-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Explaining Models and Predictions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-when-should-you-trust-predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">When Should You Trust Your Predictions?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-ensemble-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembles of Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-inferential-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Inferential Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pre-proc-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Recommended Preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#svm" id="toc-svm" class="nav-link active" data-scroll-target="#svm"><span class="header-section-number">14.1</span> A Support Vector Machine Model</a></li>
  <li>
<a href="#bayesian-optimization" id="toc-bayesian-optimization" class="nav-link" data-scroll-target="#bayesian-optimization"><span class="header-section-number">14.2</span> Bayesian Optimization</a>
  <ul class="collapse">
<li><a href="#a-gaussian-process-model" id="toc-a-gaussian-process-model" class="nav-link" data-scroll-target="#a-gaussian-process-model"><span class="header-section-number">14.2.1</span> A Gaussian process model</a></li>
  <li><a href="#acquisition-functions" id="toc-acquisition-functions" class="nav-link" data-scroll-target="#acquisition-functions"><span class="header-section-number">14.2.2</span> Acquisition functions</a></li>
  <li><a href="#tune-bayes" id="toc-tune-bayes" class="nav-link" data-scroll-target="#tune-bayes"><span class="header-section-number">14.2.3</span> The <code>tune_bayes()</code> function</a></li>
  </ul>
</li>
  <li>
<a href="#simulated-annealing" id="toc-simulated-annealing" class="nav-link" data-scroll-target="#simulated-annealing"><span class="header-section-number">14.3</span> Simulated Annealing</a>
  <ul class="collapse">
<li><a href="#simulated-annealing-search-process" id="toc-simulated-annealing-search-process" class="nav-link" data-scroll-target="#simulated-annealing-search-process"><span class="header-section-number">14.3.1</span> Simulated annealing search process</a></li>
  <li><a href="#tune-sim-anneal" id="toc-tune-sim-anneal" class="nav-link" data-scroll-target="#tune-sim-anneal"><span class="header-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</a></li>
  </ul>
</li>
  <li><a href="#iterative-summary" id="toc-iterative-summary" class="nav-link" data-scroll-target="#iterative-summary"><span class="header-section-number">14.4</span> Chapter Summary</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/davidrsch/TMwRes/edit/main/14-iterative-search.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/davidrsch/TMwRes/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="iterative-search" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Iterative Search</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Chapter @ref(grid-search) demonstrated how grid search takes a pre-defined set of candidate values, evaluates them, then chooses the best settings. Iterative search methods pursue a different strategy. During the search process, they predict which values to test next.</p>
<div class="rmdnote">
<p>When grid search is infeasible or inefficient, iterative methods are a sensible approach for optimizing tuning parameters.</p>
</div>
<p>This chapter outlines two search methods. First, we discuss <em>Bayesian optimization</em>, which uses a statistical model to predict better parameter settings. After that, the chapter describes a global search method called <em>simulated annealing</em>.</p>
<p>We use the same data on cell characteristics as the previous chapter for illustration, but change the model. This chapter uses a support vector machine model because it provides nice two-dimensional visualizations of the search processes.</p>
<section id="svm" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="svm">
<span class="header-section-number">14.1</span> A Support Vector Machine Model</h2>
<p>We once again use the cell segmentation data, described in Section @ref(evaluating-grid), for modeling, with a support vector machine (SVM) model to demonstrate sequential tuning methods. See <span class="citation" data-cites="apm">Kuhn and Johnson (<a href="#ref-apm" role="doc-biblioref">2013</a>)</span> for more information on this model. The two tuning parameters to optimize are the SVM cost value and the radial basis function kernel parameter <span class="math inline">\(\sigma\)</span>. Both parameters can have a profound effect on the model complexity and performance.</p>
<p>The SVM model uses a dot product and, for this reason, it is necessary to center and scale the predictors. Like the multilayer perceptron model, this model would benefit from the use of PCA feature extraction. However, we will not use this third tuning parameter in this chapter so that we can visualize the search process in two dimensions.</p>
<p>Along with the previously used objects (shown in Section @ref(grid-summary)), the tidymodels objects <code>svm_rec</code>, <code>svm_spec</code>, and <code>svm_wflow</code> define the model process:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">cells</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_YeoJohnson</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_spec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">svm_rbf</span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, rbf_sigma <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_wflow</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">svm_spec</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">svm_rec</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The default parameter ranges for the two tuning parameters <code>cost</code> and <code>rbf_sigma</code> are:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cost</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Cost (quantitative)</span></span>
<span><span class="co">## Transformer: log-2 [1e-100, Inf]</span></span>
<span><span class="co">## Range (transformed scale): [-10, 5]</span></span>
<span><span class="fu">rbf_sigma</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Radial Basis Function sigma (quantitative)</span></span>
<span><span class="co">## Transformer: log-10 [1e-100, Inf]</span></span>
<span><span class="co">## Range (transformed scale): [-10, 0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For illustration, let’s slightly change the kernel parameter range, to improve the visualizations of the search:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">svm_param</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">svm_wflow</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">extract_parameter_set_dials</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">update</span><span class="op">(</span>rbf_sigma <span class="op">=</span> <span class="fu">rbf_sigma</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before discussing specific details about iterative search and how it works, let’s explore the relationship between the two SVM tuning parameters and the area under the ROC curve for this specific data set. We constructed a very large regular grid, composed of 2,500 candidate values, and evaluated the grid using resampling. This is obviously impractical in regular data analysis and tremendously inefficient. However, it elucidates the path that the search process should take and where the numerically optimal value(s) occur.</p>
<p>Figure @ref(fig:roc-surface) shows the results of evaluating this grid, with lighter color corresponding to higher (better) model performance. There is a large swath in the lower diagonal of the parameter space that is relatively flat with poor performance. A ridge of best performance occurs in the upper-right portion of the space. The black dot indicates the best settings. The transition from the plateau of poor results to the ridge of best performance is very sharp. There is also a sharp drop in the area under the ROC curve just to the right of the ridge.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="premade/roc_surface.png" class="img-fluid figure-img" style="width:80.0%" alt="A heatmap of the mean area under the ROC curve for a high density grid of tuning parameter values. The best point is a solid dot in the upper-right corner. The surface has a ridge of high performance moving to the lower right. "></p>
<figcaption class="figure-caption">Heatmap of the mean area under the ROC curve for a high density grid of tuning parameter values. The best point is a solid dot in the upper-right corner.</figcaption></figure>
</div>
</div>
</div>
<p>The following search procedures require at least some resampled performance statistics before proceeding. For this purpose, the following code creates a small regular grid that resides in the flat portion of the parameter space. The <code>tune_grid()</code> function resamples this grid:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1401</span><span class="op">)</span></span>
<span><span class="va">start_grid</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">svm_param</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">update</span><span class="op">(</span></span>
<span>    cost <span class="op">=</span> <span class="fu">cost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rbf_sigma <span class="op">=</span> <span class="fu">rbf_sigma</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">grid_regular</span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1402</span><span class="op">)</span></span>
<span><span class="va">svm_initial</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">svm_wflow</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tune_grid</span><span class="op">(</span>resamples <span class="op">=</span> <span class="va">cell_folds</span>, grid <span class="op">=</span> <span class="va">start_grid</span>, metrics <span class="op">=</span> <span class="va">roc_res</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">svm_initial</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 8</span></span>
<span><span class="co">##     cost rbf_sigma .metric .estimator  mean     n std_err .config             </span></span>
<span><span class="co">##    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">## 1 0.0156  0.000001 roc_auc binary     0.864    10 0.00864 Preprocessor1_Model1</span></span>
<span><span class="co">## 2 2       0.000001 roc_auc binary     0.863    10 0.00867 Preprocessor1_Model2</span></span>
<span><span class="co">## 3 0.0156  0.0001   roc_auc binary     0.863    10 0.00862 Preprocessor1_Model3</span></span>
<span><span class="co">## 4 2       0.0001   roc_auc binary     0.866    10 0.00855 Preprocessor1_Model4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This initial grid shows fairly equivalent results, with no individual point much better than any of the others. These results can be ingested by the iterative tuning functions discussed in the following sections to be used as initial values.</p>
</section><section id="bayesian-optimization" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="bayesian-optimization">
<span class="header-section-number">14.2</span> Bayesian Optimization</h2>
<p>Bayesian optimization techniques analyze the current resampling results and create a predictive model to suggest tuning parameter values that have yet to be evaluated. The suggested parameter combination is then resampled. These results are then used in another predictive model that recommends more candidate values for testing, and so on. The process proceeds for a set number of iterations or until no further improvements occur. <span class="citation" data-cites="Shahriari">Shahriari et al. (<a href="#ref-Shahriari" role="doc-biblioref">2016</a>)</span> and <span class="citation" data-cites="frazier2018tutorial">Frazier (<a href="#ref-frazier2018tutorial" role="doc-biblioref">2018</a>)</span> are good introductions to Bayesian optimization.</p>
<p>When using Bayesian optimization, the primary concerns are how to create the model and how to select parameters recommended by that model. First, let’s consider the technique most commonly used for Bayesian optimization, the Gaussian process model.</p>
<section id="a-gaussian-process-model" class="level3" data-number="14.2.1"><h3 data-number="14.2.1" class="anchored" data-anchor-id="a-gaussian-process-model">
<span class="header-section-number">14.2.1</span> A Gaussian process model</h3>
<p>Gaussian process (GP) <span class="citation" data-cites="SCHULZ20181">(<a href="#ref-SCHULZ20181" role="doc-biblioref">Schulz, Speekenbrink, and Krause 2018</a>)</span> models are well-known statistical techniques that have a history in spatial statistics (under the name of <em>kriging methods</em>). They can be derived in multiple ways, including as a Bayesian model; see <span class="citation" data-cites="RaWi06">Rasmussen and Williams (<a href="#ref-RaWi06" role="doc-biblioref">2006</a>)</span> for an excellent reference.</p>
<p>Mathematically, a GP is a collection of random variables whose joint probability distribution is multivariate Gaussian. In the context of our application, this is the collection of performance metrics for the tuning parameter candidate values. For the previous initial grid of four samples, the realization of these four random variables were 0.8639, 0.8625, 0.8627, and 0.8659. These are assumed to be distributed as multivariate Gaussian. The inputs that define the independent variables/predictors for the GP model are the corresponding tuning parameter values (shown in Table @ref(tab:initial-gp-data)).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Resampling statistics used as the initial substrate to the Gaussian process model.</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
outcome
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
predictors
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">ROC</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">cost</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rbf_sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.8639</td>
<td style="text-align: left;">0.01562</td>
<td style="text-align: left;">0.000001</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.8625</td>
<td style="text-align: left;">2.00000</td>
<td style="text-align: left;">0.000001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.8627</td>
<td style="text-align: left;">0.01562</td>
<td style="text-align: left;">0.000100</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.8659</td>
<td style="text-align: left;">2.00000</td>
<td style="text-align: left;">0.000100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Gaussian process models are specified by their mean and covariance functions, although the latter has the most effect on the nature of the GP model. The covariance function is often parameterized in terms of the input values (denoted as <span class="math inline">\(x\)</span>). As an example, a commonly used covariance function is the squared exponential<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> function:</p>
<p><span class="math display">\[\operatorname{cov}(\boldsymbol{x}_i, \boldsymbol{x}_j) = \exp\left(-\frac{1}{2}|\boldsymbol{x}_i - \boldsymbol{x}_j|^2\right) + \sigma^2_{ij}\]</span> where <span class="math inline">\(\sigma^2_{ij}\)</span> is a constant error variance term that is zero when <span class="math inline">\(i=j\)</span>. This equation translates to:</p>
<blockquote class="blockquote">
<p>As the distance between two tuning parameter combinations increases, the covariance between the performance metrics increase exponentially.</p>
</blockquote>
<p>The nature of the equation also implies that the variation of the outcome metric is minimized at the points that have already been observed (i.e., when <span class="math inline">\(|\boldsymbol{x}_i - \boldsymbol{x}_j|^2\)</span> is zero).</p>
<p>The nature of this covariance function allows the Gaussian process to represent highly nonlinear relationships between model performance and the tuning parameters even when only a small amount of data exists.</p>
<div class="rmdwarning">
<p>However, fitting these models can be difficult in some cases, and the model becomes more computationally expensive as the number of tuning parameter combinations increases.</p>
</div>
<p>An important virtue of this model is that, since a full probability model is specified, the predictions for new inputs can reflect the entire distribution of the outcome. In other words, new performance statistics can be predicted in terms of both mean and variance.</p>
<p>Suppose that two new tuning parameters were under consideration. In Table @ref(tab:tuning-candidates), candidate <em>A</em> has a slightly better mean ROC value than candidate <em>B</em> (the current best is 0.8659). However, its variance is four-fold larger than <em>B</em>. Is this good or bad? Choosing option <em>A</em> is riskier but has potentially higher return. The increase in variance also reflects that this new value is farther from the existing data than <em>B</em>. The next section considers these aspects of GP predictions for Bayesian optimization in more detail.</p>
<div class="cell" data-layout-align="center" data-result="asis">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Two example tuning parameters considered for further sampling.</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
GP Prediction of ROC AUC
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">candidate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">0.90</td>
<td style="text-align: left;">0.000400</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: left;">0.89</td>
<td style="text-align: left;">0.000025</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="rmdnote">
<p>Bayesian optimization is an iterative process.</p>
</div>
<p>Based on the initial grid of four results, the GP model is fit, candidates are predicted, and a fifth tuning parameter combination is selected. We compute performance estimates for the new configuration, the GP is refit with the five existing results (and so on).</p>
</section><section id="acquisition-functions" class="level3" data-number="14.2.2"><h3 data-number="14.2.2" class="anchored" data-anchor-id="acquisition-functions">
<span class="header-section-number">14.2.2</span> Acquisition functions</h3>
<p>Once the Gaussian process is fit to the current data, how is it used? Our goal is to choose the next tuning parameter combination that is most likely to have “better results” than the current best. One approach to do this is to create a large candidate set (perhaps using a space-filling design) and then make mean and variance predictions on each. Using this information, we choose the most advantageous tuning parameter value.</p>
<p>A class of objective functions, called <em>acquisition functions</em>, facilitate the trade-off between mean and variance. Recall that the predicted variance of the GP models are mostly driven by how far away they are from the existing data. The trade-off between the predicted mean and variance for new candidates is frequently viewed through the lens of exploration and exploitation:</p>
<ul>
<li><p><em>Exploration</em> biases the selection towards regions where there are fewer (if any) observed candidate models. This tends to give more weight to candidates with higher variance and focuses on finding new results.</p></li>
<li><p><em>Exploitation</em> principally relies on the mean prediction to find the best (mean) value. It focuses on existing results.</p></li>
</ul>
<p>To demonstrate, let’s look at a toy example with a single parameter that has values between [0, 1] and the performance metric is <span class="math inline">\(R^2\)</span>. The true function is shown in Figure @ref(fig:performance-profile), along with five candidate values that have existing results as points.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/performance-profile-1.png" class="img-fluid figure-img" alt="A hypothetical true performance profile over an arbitrary tuning parameter. Five estimated points are also shown. The profile is highly nonlinear with a peak in-between two of the observed points." width="672"></p>
<figcaption class="figure-caption">Hypothetical true performance profile over an arbitrary tuning parameter, with five estimated points</figcaption></figure>
</div>
</div>
</div>
<p>For these data, the GP model fit is shown in Figure @ref(fig:estimated-profile). The shaded region indicates the mean <span class="math inline">\(\pm\)</span> 1 standard error. The two vertical lines indicate two candidate points that are examined in more detail later.</p>
<p>The shaded confidence region demonstrates the squared exponential variance function; it becomes very large between points and converges to zero at the existing data points.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/estimated-profile-1.png" class="img-fluid figure-img" alt="The estimated performance profile generated by the Gaussian process model. The shaded region shows one-standard-error bounds. Two vertical lines show potential points to be sampled in the next iteration." width="672"></p>
<figcaption class="figure-caption">Estimated performance profile generated by the Gaussian process model. The shaded region shows one-standard-error bounds.</figcaption></figure>
</div>
</div>
</div>
<p>This nonlinear trend passes through each observed point, but the model is not perfect. There are no observed points near the true optimum setting and, in this region, the fit could be much better. Despite this, the GP model can effectively point us in the right direction.</p>
<p>From a pure exploitation standpoint, the best choice would select the parameter value that has the best mean prediction. Here, this would be a value of 0.106, just to the right of the existing best observed point at 0.09.</p>
<p>As a way to encourage exploration, a simple (but not often used) approach is to find the tuning parameter associated with the largest confidence interval. For example, by using a single standard deviation for the <span class="math inline">\(R^2\)</span> confidence bound, the next point to sample would be 0.236. This is slightly more into the region with no observed results. Increasing the number of standard deviations used in the upper bound would push the selection farther into empty regions.</p>
<p>One of the most commonly used acquisition functions is <em>expected improvement</em>. The notion of improvement requires a value for the current best results (unlike the confidence bound approach). Since the GP can describe a new candidate point using a distribution, we can weight the parts of the distribution that show improvement using the probability of the improvement occurring.</p>
<p>For example, consider two candidate parameter values of 0.10 and 0.25 (indicated by the vertical lines in Figure @ref(fig:estimated-profile)). Using the fitted GP model, their predicted <span class="math inline">\(R^2\)</span> distributions are shown in Figure @ref(fig:two-candidates) along with a reference line for the current best results.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/two-candidates-1.png" class="img-fluid figure-img" style="width:80.0%" alt="Predicted performance distributions for two sampled tuning parameter values. For one, the distribution is slightly better than the current value with a small spread. The other parameter value is slightly worse but has a very wide spread."></p>
<figcaption class="figure-caption">Predicted performance distributions for two sampled tuning parameter values</figcaption></figure>
</div>
</div>
</div>
<p>When only considering the mean <span class="math inline">\(R^2\)</span> prediction, a parameter value of 0.10 is the better choice (see Table @ref(tab:two-exp-improve)). The tuning parameter recommendation for 0.25 is, on average, predicted to be worse than the current best. However, since it has higher variance, it has more overall probability area above the current best. As a result, it has a larger expected improvement:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Expected improvement for the two candidate tuning parameters.</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Predictions
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Std Dev</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Expected Improvment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.8679</td>
<td style="text-align: left;">0.0004317</td>
<td style="text-align: left;">0.000190</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.8671</td>
<td style="text-align: left;">0.0039301</td>
<td style="text-align: left;">0.001216</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When expected improvement is computed across the range of the tuning parameter, the recommended point to sample is much closer to 0.25 than 0.10, as shown in Figure @ref(fig:expected-improvement).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/expected-improvement-1.png" class="img-fluid figure-img" alt="The estimated performance profile generated by the Gaussian process model (top panel) and the expected improvement (bottom panel). The vertical line indicates the point of maximum improvement where estimated performance is high and the predicted variation is also large." width="672"></p>
<figcaption class="figure-caption">The estimated performance profile generated by the Gaussian process model (top panel) and the expected improvement (bottom panel). The vertical line indicates the point of maximum improvement.</figcaption></figure>
</div>
</div>
</div>
<p>Numerous acquisition functions have been proposed and discussed; in tidymodels, expected improvement is the default.</p>
</section><section id="tune-bayes" class="level3" data-number="14.2.3"><h3 data-number="14.2.3" class="anchored" data-anchor-id="tune-bayes">
<span class="header-section-number">14.2.3</span> The <code>tune_bayes()</code> function</h3>
<p>To implement iterative search via Bayesian optimization, use the <code>tune_bayes()</code> function. Its syntax is very similar to <code>tune_grid()</code> but with several additional arguments:</p>
<ul>
<li><p><code>iter</code> is the maximum number of search iterations.</p></li>
<li><p><code>initial</code> can be either an integer, an object produced using <code>tune_grid()</code>, or one of the racing functions. Using an integer specifies the size of a space-filling design that is sampled prior to the first GP model.</p></li>
<li><p><code>objective</code> is an argument for which acquisition function should be used. The <span class="pkg">tune</span> package contains functions to pass here, such as <code>exp_improve()</code> or <code>conf_bound()</code>.</p></li>
<li><p>The <code>param_info</code> argument, in this case, specifies the range of the parameters as well as any transformations that are used. These are used to define the search space. In situations where the default parameter objects are insufficient, <code>param_info</code> is used to override the defaults.</p></li>
</ul>
<p>The <code>control</code> argument now uses the results of <code>control_bayes()</code>. Some helpful arguments there are:</p>
<ul>
<li><p><code>no_improve</code> is an integer that will stop the search if improved parameters are not discovered within <code>no_improve</code> iterations.</p></li>
<li><p><code>uncertain</code> is also an integer (or <code>Inf</code>) that will take an <em>uncertainty sample</em> if there is no improvement within <code>uncertain</code> iterations. This will select the next candidate that has large variation. It has the effect of pure exploration since it does not consider the mean prediction.</p></li>
<li><p><code>verbose</code> is a logical that will print logging information as the search proceeds.</p></li>
</ul>
<p>Let’s use the first SVM results from Section @ref(svm) as the initial substrate for the Gaussian process model. Recall that, for this application, we want to maximize the area under the ROC curve. Our code is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_bayes</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1403</span><span class="op">)</span></span>
<span><span class="va">svm_bo</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">svm_wflow</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tune_bayes</span><span class="op">(</span></span>
<span>    resamples <span class="op">=</span> <span class="va">cell_folds</span>,</span>
<span>    metrics <span class="op">=</span> <span class="va">roc_res</span>,</span>
<span>    initial <span class="op">=</span> <span class="va">svm_initial</span>,</span>
<span>    param_info <span class="op">=</span> <span class="va">svm_param</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">25</span>,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The search process starts with an initial best value of 0.8659 for the area under the ROC curve. A Gaussian process model uses these four statistics to create a model. The large candidate set is automatically generated and scored using the expected improvement acquisition function. The first iteration failed to improve the outcome with an ROC value of 0.86315. After fitting another Gaussian process model with the new outcome value, the second iteration also failed to yield an improvement.</p>
<p>The log of the first two iterations, produced by the <code>verbose</code> option, was:</p>
<p>The search continues. There were a total of 9 improvements in the outcome along the way at iterations 3, 4, 5, 6, 8, 13, 22, 23, and 24. The best result occurred at iteration 24 with an area under the ROC curve of 0.8986.</p>
<p>The last step was:</p>
<p>The functions that are used to interrogate the results are the same as those used for grid search (e.g., <code>collect_metrics()</code>, etc.). For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_best</span><span class="op">(</span><span class="va">svm_bo</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 9</span></span>
<span><span class="co">##    cost rbf_sigma .metric .estimator  mean     n std_err .config .iter</span></span>
<span><span class="co">##   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class="co">## 1  31.8   0.00160 roc_auc binary     0.899    10 0.00785 Iter24     24</span></span>
<span><span class="co">## 2  30.8   0.00191 roc_auc binary     0.899    10 0.00791 Iter23     23</span></span>
<span><span class="co">## 3  31.4   0.00166 roc_auc binary     0.899    10 0.00784 Iter22     22</span></span>
<span><span class="co">## 4  31.8   0.00153 roc_auc binary     0.899    10 0.00783 Iter13     13</span></span>
<span><span class="co">## 5  30.8   0.00163 roc_auc binary     0.899    10 0.00782 Iter15     15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>autoplot()</code> function has several options for iterative search methods. Figure @ref(fig:progress-plot) shows how the outcome changed over the search by using <code>autoplot(svm_bo, type = "performance")</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/progress-plot-1.png" class="img-fluid figure-img" alt="The progress of the Bayesian optimization produced when the `autoplot()` method is used with `type = 'performance'`. The plot shows the estimated performance on the y axis versus the iteration number on the x axis. Confidence intervals are shown for the points." width="672"></p>
<figcaption class="figure-caption">The progress of the Bayesian optimization produced when the <code>autoplot()</code> method is used with <code>type = "performance"</code></figcaption></figure>
</div>
</div>
</div>
<p>An additional type of plot uses <code>type = "parameters"</code> that shows the parameter values over iterations.</p>
<p>The animation below visualizes the results of the search. The black <span class="math inline">\(\times\)</span> values show the starting values contained in <code>svm_initial</code>. The top-left blue panel shows the predicted mean value of the area under the ROC curve. The red panel on the top-right displays the predicted variation in the ROC values while the bottom plot visualizes the expected improvement. In each panel, darker colors indicate less attractive values (e.g., small mean values, large variation, and small improvements).</p>
<video width="720" height="720" controls=""><source src="bo_search.mp4" type="video/mp4"></video><p>The surface of the predicted mean surface is very inaccurate in the first few iterations of the search. Despite this, it does help guide the process to the region of good performance. In other words, the Gaussian process model is wrong but shows itself to be very useful. Within the first ten iterations, the search is sampling near the optimum location.</p>
<p>While the best tuning parameter combination is on the boundary of the parameter space, Bayesian optimization will often choose new points on other sides of the boundary. While we can adjust the ratio of exploration and exploitation, the search tends to sample boundary points early on.</p>
<div class="rmdnote">
<p>If the search is seeded with an initial grid, a space-filling design would probably be a better choice than a regular design. It samples more unique values of the parameter space and would improve the predictions of the standard deviation in the early iterations.</p>
</div>
<p>Finally, if the user interrupts the <code>tune_bayes()</code> computations, the function returns the current results (instead of resulting in an error).</p>
</section></section><section id="simulated-annealing" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="simulated-annealing">
<span class="header-section-number">14.3</span> Simulated Annealing</h2>
<p><em>Simulated annealing</em> (SA) <span class="citation" data-cites="kirkpatrick1983optimization van1987simulated">(<a href="#ref-kirkpatrick1983optimization" role="doc-biblioref">Kirkpatrick, Gelatt, and Vecchi 1983</a>; <a href="#ref-van1987simulated" role="doc-biblioref">Van Laarhoven and Aarts 1987</a>)</span> is a general nonlinear search routine inspired by the process in which metal cools. It is a global search method that can effectively navigate many different types of search landscapes, including discontinuous functions. Unlike most gradient-based optimization routines, simulated annealing can reassess previous solutions.</p>
<section id="simulated-annealing-search-process" class="level3" data-number="14.3.1"><h3 data-number="14.3.1" class="anchored" data-anchor-id="simulated-annealing-search-process">
<span class="header-section-number">14.3.1</span> Simulated annealing search process</h3>
<p>The process of using simulated annealing starts with an initial value and embarks on a controlled random walk through the parameter space. Each new candidate parameter value is a small perturbation of the previous value that keeps the new point within a local neighborhood.</p>
<p>The candidate point is resampled to obtain its corresponding performance value. If this achieves better results than the previous parameters, it is accepted as the new best and the process continues. If the results are worse than the previous value the search procedure may still use this parameter to define further steps. This depends on two factors. First, the likelihood of accepting a bad result decreases as performance becomes worse. In other words, a slightly worse result has a better chance of acceptance than one with a large drop in performance. The other factor is the number of search iterations. Simulated annealing wants to accept fewer suboptimal values as the search proceeds. From these two factors, the <em>acceptance probability</em> for a bad result can be formalized as:</p>
<p><span class="math display">\[\operatorname{Pr}[\text{accept suboptimal parameters at iteration } i] = \exp(c\times D_i \times i)\]</span></p>
<p>where <span class="math inline">\(i\)</span> is the iteration number, <span class="math inline">\(c\)</span> is a user-specified constant, and <span class="math inline">\(D_i\)</span> is the percent difference between the old and new values (where negative values imply worse results). For a bad result, we determine the acceptance probability and compare it to a random uniform number. If the random number is greater than the probability value, the search discards the current parameters and the next iteration creates its candidate value in the neighborhood of the previous value. Otherwise, the next iteration forms the next set of parameters based on the current (suboptimal) values.</p>
<div class="rmdnote">
<p>The acceptance probabilities of simulated annealing allow the search to proceed in the wrong direction, at least for the short term, with the potential to find a much better region of the parameter space in the long run.</p>
</div>
<p>How are the acceptance probabilities influenced? The heatmap in Figure @ref(fig:acceptance-prob) shows how the acceptance probability can change over iterations, performance, and the user-specified coefficient.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/acceptance-prob-1.png" class="img-fluid figure-img" style="width:80.0%" alt="A heatmap of the simulated annealing acceptance probabilities for different coefficient values. The probabilities are affected by the both the iteration number as well as how far off the the performance is from the current best."></p>
<figcaption class="figure-caption">Heatmap of the simulated annealing acceptance probabilities for different coefficient values</figcaption></figure>
</div>
</div>
</div>
<p>The user can adjust the coefficients to find a probability profile that suits their needs. In <code><a href="https://finetune.tidymodels.org/reference/control_sim_anneal.html">finetune::control_sim_anneal()</a></code>, the default for this <code>cooling_coef</code> argument is 0.02. Decreasing this coefficient will encourage the search to be more forgiving of poor results.</p>
<p>This process continues for a set amount of iterations but can halt if no globally best results occur within a pre-determined number of iterations. However, it can be very helpful to set a <em>restart threshold</em>. If there are a string of failures, this feature revisits the last globally best parameter settings and starts anew.</p>
<p>The main important detail is to define how to perturb the tuning parameters from iteration to iteration. There are a variety of methods in the literature for this. We follow the method given in <span class="citation" data-cites="gsa">Bohachevsky, Johnson, and Stein (<a href="#ref-gsa" role="doc-biblioref">1986</a>)</span> called <em>generalized simulated annealing</em>. For continuous tuning parameters, we define a small radius to specify the local “neighborhood.” For example, suppose there are two tuning parameters and each is bounded by zero and one. The simulated annealing process generates random values on the surrounding radius and randomly chooses one to be the current candidate value.</p>
<p>In our implementation, the neighborhood is determined by scaling the current candidate to be between zero and one based on the range of the parameter object, so radius values between 0.05 and 0.15 seem reasonable. For these values, the fastest that the search could go from one side of the parameter space to the other is about 10 iterations. The size of the radius controls how quickly the search explores the parameter space. In our implementation, a range of radii is specified so different magnitudes of “local” define the new candidate values.</p>
<p>To illustrate, we’ll use the two main <span class="pkg">glmnet</span> tuning parameters:</p>
<ul>
<li><p>The amount of total regularization (<code>penalty</code>). The default range for this parameter is $10^{-10} $ to <span class="math inline">\(10^{ 0}\)</span>. It is typical to use a log (base-10) transformation for this parameter.</p></li>
<li><p>The proportion of the lasso penalty (<code>mixture</code>). This is bounded at zero and one with no transformation.</p></li>
</ul>
<p>The process starts with initial values of <code>penalty = 0.025</code> and <code>mixture = 0.050</code>. Using a radius that randomly fluctuates between 0.050 and 0.015, the data are appropriately scaled, random values are generated on radii around the initial point, then one is randomly chosen as the candidate. For illustration, we will assume that all candidate values are improvements. Using the new value, a set of new random neighbors are generated, one is chosen, and so on. Figure @ref(fig:iterative-neighborhood) shows six iterations as the search proceeds toward the upper left corner.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/iterative-neighborhood-1.png" class="img-fluid figure-img" style="width:80.0%" alt="An illustration of how simulated annealing determines what is the local neighborhood for two numeric tuning parameters. The clouds of points show possible next values where one would be selected at random. The candidate points are small circular clouds surrounding the current best point."></p>
<figcaption class="figure-caption">An illustration of how simulated annealing determines what is the local neighborhood for two numeric tuning parameters. The clouds of points show possible next values where one would be selected at random.</figcaption></figure>
</div>
</div>
</div>
<p>Note that, during some iterations, the candidate sets along the radius exclude points outside of the parameter boundaries. Also, our implementation biases the choice of the next tuning parameter configurations <em>away</em> from new values that are very similar to previous configurations.</p>
<p>For non-numeric parameters, we assign a probability for how often the parameter value changes.</p>
</section><section id="tune-sim-anneal" class="level3" data-number="14.3.2"><h3 data-number="14.3.2" class="anchored" data-anchor-id="tune-sim-anneal">
<span class="header-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</h3>
<p>To implement iterative search via simulated annealing, use the <code>tune_sim_anneal()</code> function. The syntax for this function is nearly identical to <code>tune_bayes()</code>. There are no options for acquisition functions or uncertainty sampling. The <code>control_sim_anneal()</code> function has some details that define the local neighborhood and the cooling schedule:</p>
<ul>
<li><p><code>no_improve</code>, for simulated annealing, is an integer that will stop the search if no global best or improved results are discovered within <code>no_improve</code> iterations. Accepted suboptimal or discarded parameters count as “no improvement.”</p></li>
<li><p><code>restart</code> is the number of iterations with no new best results before starting from the previous best results.</p></li>
<li><p><code>radius</code> is a numeric vector on (0, 1) that defines the minimum and maximum radius of the local neighborhood around the initial point.</p></li>
<li><p><code>flip</code> is a probability value that defines the chances of altering the value of categorical or integer parameters.</p></li>
<li><p><code>cooling_coef</code> is the <span class="math inline">\(c\)</span> coefficient in <span class="math inline">\(\exp(c\times D_i \times i)\)</span> that modulates how quickly the acceptance probability decreases over iterations. Larger values of <code>cooling_coef</code> decrease the probability of accepting a suboptimal parameter setting.</p></li>
</ul>
<p>For the cell segmentation data, the syntax is very consistent with the previously used functions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl_sa</span> <span class="op">&lt;-</span> <span class="fu">control_sim_anneal</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span>, no_improve <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1404</span><span class="op">)</span></span>
<span><span class="va">svm_sa</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">svm_wflow</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tune_sim_anneal</span><span class="op">(</span></span>
<span>    resamples <span class="op">=</span> <span class="va">cell_folds</span>,</span>
<span>    metrics <span class="op">=</span> <span class="va">roc_res</span>,</span>
<span>    initial <span class="op">=</span> <span class="va">svm_initial</span>,</span>
<span>    param_info <span class="op">=</span> <span class="va">svm_param</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    control <span class="op">=</span> <span class="va">ctrl_sa</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The simulated annealing process discovered new global optimums at 6 different iterations. The earliest improvement was at iteration 2 and the final optimum occured at iteration 37. The best overall results occured at iteration 37 with a mean area under the ROC curve of 0.898 (compared to an initial best of 0.8659). There were 4 restarts at iterations 13, 26, 34, and 45 as well as 7 discarded candidates during the process.</p>
<p>The <code>verbose</code> option prints details of the search process. The output for the first five iterations was:</p>
<p>The output for last ten iterations was:</p>
<div class="cell" data-layout-align="center">
<pre><code>## 40 + better suboptimal  roc_auc=0.89285 (+/-0.008806)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 41 + better suboptimal  roc_auc=0.89419 (+/-0.008628)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 42 + better suboptimal  roc_auc=0.8979 (+/-0.007741)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 43 ─ discard suboptimal roc_auc=0.86412 (+/-0.009579)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 44 ◯ accept suboptimal  roc_auc=0.89119 (+/-0.008697)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 45 ✖ restart from best  roc_auc=0.8921 (+/-0.00885)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 46 ◯ accept suboptimal  roc_auc=0.89657 (+/-0.008539)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 47 ◯ accept suboptimal  roc_auc=0.88647 (+/-0.008694)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 48 + better suboptimal  roc_auc=0.89035 (+/-0.008894)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 49 + better suboptimal  roc_auc=0.8977 (+/-0.007898)
## 
## i Fold01: preprocessor 1/1
## 
## ✓ Fold01: preprocessor 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1
## 
## ✓ Fold01: preprocessor 1/1, model 1/1
## 
## i Fold01: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold01: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold02: preprocessor 1/1
## 
## ✓ Fold02: preprocessor 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1
## 
## ✓ Fold02: preprocessor 1/1, model 1/1
## 
## i Fold02: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold02: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold03: preprocessor 1/1
## 
## ✓ Fold03: preprocessor 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1
## 
## ✓ Fold03: preprocessor 1/1, model 1/1
## 
## i Fold03: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold03: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold04: preprocessor 1/1
## 
## ✓ Fold04: preprocessor 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1
## 
## ✓ Fold04: preprocessor 1/1, model 1/1
## 
## i Fold04: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold04: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold05: preprocessor 1/1
## 
## ✓ Fold05: preprocessor 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1
## 
## ✓ Fold05: preprocessor 1/1, model 1/1
## 
## i Fold05: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold05: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold06: preprocessor 1/1
## 
## ✓ Fold06: preprocessor 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1
## 
## ✓ Fold06: preprocessor 1/1, model 1/1
## 
## i Fold06: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold06: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold07: preprocessor 1/1
## 
## ✓ Fold07: preprocessor 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1
## 
## ✓ Fold07: preprocessor 1/1, model 1/1
## 
## i Fold07: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold07: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold08: preprocessor 1/1
## 
## ✓ Fold08: preprocessor 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1
## 
## ✓ Fold08: preprocessor 1/1, model 1/1
## 
## i Fold08: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold08: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold09: preprocessor 1/1
## 
## ✓ Fold09: preprocessor 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1
## 
## ✓ Fold09: preprocessor 1/1, model 1/1
## 
## i Fold09: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold09: preprocessor 1/1, model 1/1 (predictions)
## 
## i Fold10: preprocessor 1/1
## 
## ✓ Fold10: preprocessor 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1
## 
## ✓ Fold10: preprocessor 1/1, model 1/1
## 
## i Fold10: preprocessor 1/1, model 1/1 (extracts)
## 
## i Fold10: preprocessor 1/1, model 1/1 (predictions)
## 
## 50 ─ discard suboptimal roc_auc=0.86146 (+/-0.009902)</code></pre>
</div>
<p>As with the other <code>tune_*()</code> functions, the corresponding <code>autoplot()</code> function produces visual assessments of the results. Using <code>autoplot(svm_sa, type = "performance")</code> shows the performance over iterations (Figure @ref(fig:sa-iterations)) while <code>autoplot(svm_sa, type = "parameters")</code> plots performance versus specific tuning parameter values (Figure @ref(fig:sa-parameters)).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/sa-iterations-1.png" class="img-fluid figure-img" alt="The progress of the simulated annealing process shown when the `autoplot()` method is used with `type = 'performance'`. The plot shows the estimated performance on the y axis versus the iteration number on the x axis. Confidence intervals are shown for the points." width="672"></p>
<figcaption class="figure-caption">Progress of the simulated annealing process shown when the <code>autoplot()</code> method is used with <code>type = "performance"</code></figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/sa-parameters-1.png" class="img-fluid figure-img" alt="A visualization of performance versus tuning parameter values when the `autoplot()` method is used with `type = 'parameters'`. The plot shows different panels for each tuning parameter in their transformed units." width="672"></p>
<figcaption class="figure-caption">Performance versus tuning parameter values when the <code>autoplot()</code> method is used with <code>type = "parameters"</code>.</figcaption></figure>
</div>
</div>
</div>
<p>A visualization of the search path helps to understand where the search process did well and where it went astray:</p>
<video width="720" height="720" controls=""><source src="sa_search.mp4" type="video/mp4"></video><p>Like <code>tune_bayes()</code>, manually stopping execution will return the completed iterations.</p>
</section></section><section id="iterative-summary" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="iterative-summary">
<span class="header-section-number">14.4</span> Chapter Summary</h2>
<p>This chapter described two iterative search methods for optimizing tuning parameters. Bayes optimization uses a predictive model trained on existing resampling results to suggest tuning parameter values, while simulated annealing walks through the hyperparameter space to find good values. Both can be effective at finding good values alone or as a follow-up method used after an initial grid search to further <span class="pkg">finetune</span> performance.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-gsa" class="csl-entry" role="listitem">
Bohachevsky, I, M Johnson, and M Stein. 1986. <span>“Generalized Simulated Annealing for Function Optimization.”</span> <em>Technometrics</em> 28 (3): 209–17.
</div>
<div id="ref-frazier2018tutorial" class="csl-entry" role="listitem">
Frazier, R. 2018. <span>“A Tutorial on Bayesian Optimization.”</span> <a href="https://arxiv.org/abs/1807.02811">https://arxiv.org/abs/1807.02811</a>.
</div>
<div id="ref-kirkpatrick1983optimization" class="csl-entry" role="listitem">
Kirkpatrick, S, D Gelatt, and M Vecchi. 1983. <span>“Optimization by Simulated Annealing.”</span> <em>Science</em> 220 (4598): 671–80.
</div>
<div id="ref-apm" class="csl-entry" role="listitem">
Kuhn, M, and K Johnson. 2013. <em>Applied Predictive Modeling</em>. Springer.
</div>
<div id="ref-RaWi06" class="csl-entry" role="listitem">
Rasmussen, C, and C Williams. 2006. <em>Gaussian Processes for Machine Learning</em>. <em>Gaussian Processes for Machine Learning</em>. MIT Press.
</div>
<div id="ref-SCHULZ20181" class="csl-entry" role="listitem">
Schulz, E, M Speekenbrink, and A Krause. 2018. <span>“A Tutorial on Gaussian Process Regression: Modelling, Exploring, and Exploiting Functions.”</span> <em>Journal of Mathematical Psychology</em> 85: 1–16.
</div>
<div id="ref-Shahriari" class="csl-entry" role="listitem">
Shahriari, B., K. Swersky, Z. Wang, R. P. Adams, and N. de Freitas. 2016. <span>“Taking the Human Out of the Loop: A Review of Bayesian Optimization.”</span> <em>Proceedings of the IEEE</em> 104 (1): 148–75.
</div>
<div id="ref-van1987simulated" class="csl-entry" role="listitem">
Van Laarhoven, P, and E Aarts. 1987. <span>“Simulated Annealing.”</span> In <em>Simulated Annealing: Theory and Applications</em>, 7–15. Springer.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>This equation is also the same as the <em>radial basis function</em> used in kernel methods, such as the SVM model that is currently being used. This is a coincidence; this covariance function is unrelated to the SVM tuning parameter that we are using.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./13-grid-search.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Grid Search</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./15-workflow-sets.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Screening Many Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Modelado Ordenado con R fue escrito por Max Kuhn, y Julia Silge.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>